/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Using a slow image processor as `use_fast` is unset and a slow processor was saved with this model. `use_fast=True` will be the default behavior in v4.48, even if the model was saved with a slow processor. This will result in minor differences in outputs. You'll still be able to use a slow processor with `use_fast=False`.
Namespace(mode='build_knowledge_base', config_file_env='./configs/env_machine.yml', config_file_expt='./configs/expts/dog120_all.yml', num_per_category='3', kshot=None, region_num=None, superclass=None, gallery_out=None, fusion_method='concat', knowledge_base_dir='./experiments/dog120/knowledge_base', query_image=None, test_data_dir=None, results_out='./results.json', use_slow_thinking=None, confidence_threshold=0.8, similarity_threshold=0.7)
{'setup': 'ours', 'experiment': 5.0, 'dataset_name': 'dog', 'num_classes': 120, 'num_base': 60, 'num_novel': 60, 'seed': 1, 'batch_size': 256, 'clustering_method': 'multi_clip_voting', 'model_size': 'ViT-B/16', 'model_size_vqa': 'OPT6.7B-COCO', 'model_size_mllm': 'Qwen2.5-VL-7B', 'model_type_llm': 'gpt-3.5-turbo', 'image_size': 224, 'verbose': False, 'host': 'xiao', 'num_workers': 16, 'device': 'cuda', 'device_count': '1', 'device_id': '0', 'data_dir': './datasets/dogs_120', 'expt_dir': './experiments/dog120', 'expt_dir_describe': './experiments/dog120/describe', 'path_vqa_questions': './experiments/dog120/describe/dog_vqa_questions_ours', 'path_vqa_answers': './experiments/dog120/describe/dog_attributes_pairs', 'path_llm_prompts': './experiments/dog120/describe/dog_llm_prompts', 'path_identify_answers': './experiments/dog120/identify', 'expt_dir_guess': './experiments/dog120/guess', 'path_llm_replies_raw': './experiments/dog120/guess/dog_llm_replies_raw', 'path_llm_replies_jsoned': './experiments/dog120/guess/dog_llm_replies_jsoned', 'path_llm_gussed_names': './experiments/dog120/guess/dog_llm_gussed_names', 'expt_dir_gallery': './experiments/dog120/gallery', 'path_references': './experiments/dog120/gallery/dog_image_references', 'path_regions': './experiments/dog120/gallery/dog_image_regions', 'path_descriptions': './experiments/dog120/gallery/dog_image_descriptions_attn', 'expt_dir_grouping': './experiments/dog120/grouping'}
初始化MLLM模型...
Loading checkpoint shards:   0%|          | 0/5 [00:00<?, ?it/s]Loading checkpoint shards:  20%|██        | 1/5 [07:17<29:09, 437.47s/it]Loading checkpoint shards:  40%|████      | 2/5 [11:01<15:36, 312.19s/it]Loading checkpoint shards:  60%|██████    | 3/5 [13:19<07:45, 232.54s/it]Loading checkpoint shards:  80%|████████  | 4/5 [15:36<03:14, 194.82s/it]Loading checkpoint shards: 100%|██████████| 5/5 [15:56<00:00, 131.85s/it]Loading checkpoint shards: 100%|██████████| 5/5 [15:56<00:00, 191.38s/it]
local_model_path: /home/Dataset/Models/Qwen/Qwen2.5-VL-7B-Instruct
初始化知识库构建器...
Traceback (most recent call last):
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
OSError: [Errno 101] Network is unreachable

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/urllib3/connectionpool.py", line 488, in _make_request
    raise new_e
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/urllib3/connectionpool.py", line 464, in _make_request
    self._validate_conn(conn)
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/urllib3/connectionpool.py", line 1093, in _validate_conn
    conn.connect()
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/urllib3/connection.py", line 753, in connect
    self.sock = sock = self._new_conn()
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPSConnection object at 0x79edfce4e1c0>: Failed to establish a new connection: [Errno 101] Network is unreachable

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/requests/adapters.py", line 667, in send
    resp = conn.urlopen(
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /Salesforce/blip-itm-base-coco/resolve/main/config.json (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x79edfce4e1c0>: Failed to establish a new connection: [Errno 101] Network is unreachable'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/huggingface_hub/file_download.py", line 1546, in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/huggingface_hub/file_download.py", line 1463, in get_hf_file_metadata
    r = _request_wrapper(
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/huggingface_hub/file_download.py", line 286, in _request_wrapper
    response = _request_wrapper(
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/huggingface_hub/file_download.py", line 309, in _request_wrapper
    response = http_backoff(method=method, url=url, **params, retry_on_exceptions=(), retry_on_status_codes=(429,))
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/huggingface_hub/utils/_http.py", line 310, in http_backoff
    response = session.request(method=method, url=url, **kwargs)
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/huggingface_hub/utils/_http.py", line 96, in send
    return super().send(request, *args, **kwargs)
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/requests/adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /Salesforce/blip-itm-base-coco/resolve/main/config.json (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x79edfce4e1c0>: Failed to establish a new connection: [Errno 101] Network is unreachable'))"), '(Request ID: f4951dc2-5a21-4ddc-8577-33f76acd9e20)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/transformers/utils/hub.py", line 342, in cached_file
    resolved_file = hf_hub_download(
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/huggingface_hub/file_download.py", line 1010, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/huggingface_hub/file_download.py", line 1117, in _hf_hub_download_to_cache_dir
    _raise_on_head_call_error(head_call_error, force_download, local_files_only)
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/huggingface_hub/file_download.py", line 1661, in _raise_on_head_call_error
    raise LocalEntryNotFoundError(
huggingface_hub.errors.LocalEntryNotFoundError: An error happened while trying to locate the file on the Hub and we cannot find the requested files in the local cache. Please check your connection and try again or make sure your Internet connection is on.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hdl/project/fgvr_test/discovering.py", line 392, in <module>
    system = FastSlowThinkingSystem(
  File "/home/hdl/project/fgvr_test/fast_slow_thinking_system.py", line 64, in __init__
    self.kb_builder = KnowledgeBaseBuilder(
  File "/home/hdl/project/fgvr_test/knowledge_base_builder.py", line 51, in __init__
    self.retrieval = MultimodalRetrieval(
  File "/home/hdl/project/fgvr_test/retrieval/multimodal_retrieval.py", line 46, in __init__
    self.blip_processor = AutoProcessor.from_pretrained("Salesforce/blip-itm-base-coco")
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/transformers/models/auto/processing_auto.py", line 305, in from_pretrained
    config = AutoConfig.from_pretrained(
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/transformers/models/auto/configuration_auto.py", line 1075, in from_pretrained
    config_dict, unused_kwargs = PretrainedConfig.get_config_dict(pretrained_model_name_or_path, **kwargs)
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/transformers/configuration_utils.py", line 594, in get_config_dict
    config_dict, kwargs = cls._get_config_dict(pretrained_model_name_or_path, **kwargs)
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/transformers/configuration_utils.py", line 653, in _get_config_dict
    resolved_config_file = cached_file(
  File "/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/transformers/utils/hub.py", line 385, in cached_file
    raise EnvironmentError(
OSError: We couldn't connect to 'https://huggingface.co' to load this file, couldn't find it in the cached files and it looks like Salesforce/blip-itm-base-coco is not the path to a directory containing a file named config.json.
Checkout your internet connection or see how to run the library in offline mode at 'https://huggingface.co/docs/transformers/installation#offline-mode'.

/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/data/oldhome/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Using a slow image processor as `use_fast` is unset and a slow processor was saved with this model. `use_fast=True` will be the default behavior in v4.48, even if the model was saved with a slow processor. This will result in minor differences in outputs. You'll still be able to use a slow processor with `use_fast=False`.
Namespace(mode='terminal_decision_enhanced', config_file_env='./configs/env_machine.yml', config_file_expt='./configs/expts/car196_all.yml', num_per_category='3', knowledge_base_dir='./knowledge_base', query_image=None, test_data_dir=None, results_out='./results.json', use_slow_thinking=None, confidence_threshold=0.8, similarity_threshold=0.7, enable_mllm_intermediate_judge=False, infer_dir='./experiments/car196/infer', classify_dir='./experiments/car196/classify')
{'setup': 'ours', 'experiment': 5.0, 'dataset_name': 'car', 'num_classes': 196, 'num_base': 98, 'num_novel': 98, 'seed': 1, 'batch_size': 32, 'clustering_method': 'multi_clip_voting', 'model_size': 'ViT-B/16', 'model_size_vqa': 'FlanT5-XXL', 'model_size_mllm': 'Qwen2.5-VL-7B', 'model_type_llm': 'gpt-3.5-turbo', 'image_size': 224, 'verbose': False, 'host': 'xiao', 'num_workers': 16, 'device': 'cuda', 'device_count': '1', 'device_id': '0', 'data_dir': './datasets/car_196', 'expt_dir': './experiments/car196', 'expt_dir_describe': './experiments/car196/describe', 'path_vqa_questions': './experiments/car196/describe/car_vqa_questions_ours', 'path_vqa_answers': './experiments/car196/describe/car_attributes_pairs', 'path_llm_prompts': './experiments/car196/describe/car_llm_prompts', 'path_identify_answers': './experiments/car196/identify', 'expt_dir_guess': './experiments/car196/guess', 'path_llm_replies_raw': './experiments/car196/guess/car_llm_replies_raw', 'path_llm_replies_jsoned': './experiments/car196/guess/car_llm_replies_jsoned', 'path_llm_gussed_names': './experiments/car196/guess/car_llm_gussed_names', 'expt_dir_gallery': './experiments/car196/gallery', 'path_references': './experiments/car196/gallery/car_image_references', 'path_regions': './experiments/car196/gallery/car_image_regions', 'path_descriptions': './experiments/car196/gallery/car_image_descriptions_attn', 'expt_dir_grouping': './experiments/car196/grouping'}
ğŸ”§ ç»ˆç«¯å†³ç­–å¢å¼ºæ¨¡å¼
ğŸ“ åˆ†ç±»ç»“æœå°†ä¿å­˜åˆ°: ./experiments/car196/classify
ğŸ” æ£€æŸ¥å¿«æ€è€ƒå¢å¼ºç»“æœ: ./experiments/car196/classify/fast_classification_results_enhanced.json
ğŸ” æ£€æŸ¥æ…¢æ€è€ƒå¢å¼ºç»“æœ: ./experiments/car196/classify/slow_classification_results_enhanced.json
âœ… åŠ è½½äº† 87 ä¸ªå¢å¼ºå¿«æ€è€ƒåˆ†ç±»ç»“æœ
âœ… åŠ è½½äº† 109 ä¸ªå¢å¼ºæ…¢æ€è€ƒåˆ†ç±»ç»“æœ
ğŸ”„ æ›´æ–°å¢å¼ºç»“æœä¸­çš„is_correctå­—æ®µ...
âœ… å·²æ›´æ–°æ‰€æœ‰å¢å¼ºç»“æœçš„is_correctå­—æ®µ
ğŸ” å‘ç° 22 ä¸ªéœ€è¦ç»ˆç«¯å†³ç­–çš„æ ·æœ¬
ğŸš€ å¼€å§‹å¤„ç†éœ€è¦ç»ˆç«¯å†³ç­–çš„æ ·æœ¬...
åˆå§‹åŒ–çŸ¥è¯†åº“æ„å»ºå™¨...
ğŸš€ èåˆæ–¹æ³•ä¸º 'weighted'ï¼Œè·³è¿‡BLIPæ¨¡å‹åŠ è½½ä»¥èŠ‚çœæ˜¾å­˜
è·å–MLLMæ¨¡å‹å®ä¾‹ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰...
ğŸš€ åˆå§‹åŒ–MLLMæ¨¡å‹: Qwen2.5-VL-7B on cuda
ğŸ“Š å½“å‰æ˜¾å­˜: 0.56GB / 79.25GB
Loading checkpoint shards:   0%|          | 0/5 [00:00<?, ?it/s]Loading checkpoint shards:  20%|â–ˆâ–ˆ        | 1/5 [00:02<00:08,  2.25s/it]Loading checkpoint shards:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 2/5 [00:04<00:06,  2.24s/it]Loading checkpoint shards:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 3/5 [00:06<00:04,  2.32s/it]Loading checkpoint shards:  80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 4/5 [00:09<00:02,  2.27s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5/5 [00:09<00:00,  1.71s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5/5 [00:09<00:00,  1.96s/it]
local_model_path: ./models/Qwen/Qwen2.5-VL-7B-Instruct
âœ… MLLMæ¨¡å‹åˆå§‹åŒ–å®Œæˆ
ğŸ“Š åŠ è½½åæ˜¾å­˜: 31.59GB / 79.25GB
åˆå§‹åŒ–å¿«æ€è€ƒæ¨¡å—...
æœªæ‰¾åˆ°å†å²ç»Ÿè®¡é‡æ–‡ä»¶ï¼Œå°†ä»å¤´å¼€å§‹
åˆå§‹åŒ–æ…¢æ€è€ƒæ¨¡å—...
å¿«æ…¢æ€è€ƒç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ!
ä» ./experiments/car196/knowledge_base åŠ è½½çŸ¥è¯†åº“...
ç±»åˆ«å›¾åƒè·¯å¾„å·²ä» ./experiments/car196/knowledge_base/category_image_paths.json åŠ è½½
åŠ è½½äº† 255 ä¸ªç±»åˆ«çš„å›¾åƒè·¯å¾„
çŸ¥è¯†åº“å·²ä» ./experiments/car196/knowledge_base åŠ è½½
çŸ¥è¯†åº“åŠ è½½å®Œæˆ!
å·²åŠ è½½çŸ¥è¯†åº“: ./experiments/car196/knowledge_base
Processing terminal decisions:   0%|          | 0/22 [00:00<?, ?it/s]Processing terminal decisions:   5%|â–         | 1/22 [00:22<07:53, 22.57s/it]Processing terminal decisions:   9%|â–‰         | 2/22 [00:34<05:23, 16.16s/it]Processing terminal decisions:  14%|â–ˆâ–        | 3/22 [00:48<04:50, 15.29s/it]Processing terminal decisions:  18%|â–ˆâ–Š        | 4/22 [01:04<04:42, 15.69s/it]Processing terminal decisions:  23%|â–ˆâ–ˆâ–       | 5/22 [01:16<04:04, 14.41s/it]Processing terminal decisions:  27%|â–ˆâ–ˆâ–‹       | 6/22 [01:40<04:38, 17.38s/it]Processing terminal decisions:  32%|â–ˆâ–ˆâ–ˆâ–      | 7/22 [01:50<03:48, 15.20s/it]Processing terminal decisions:  36%|â–ˆâ–ˆâ–ˆâ–‹      | 8/22 [02:04<03:27, 14.80s/it]Processing terminal decisions:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 9/22 [02:17<03:05, 14.31s/it]Processing terminal decisions:  45%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 10/22 [02:33<02:55, 14.59s/it]Processing terminal decisions:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 11/22 [02:46<02:35, 14.12s/it]Processing terminal decisions:  55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 12/22 [02:58<02:15, 13.52s/it]Processing terminal decisions:  59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 13/22 [03:12<02:03, 13.71s/it]Processing terminal decisions:  64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 14/22 [03:27<01:51, 13.94s/it]Processing terminal decisions:  68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 15/22 [03:28<01:10, 10.11s/it]Processing terminal decisions:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 16/22 [03:42<01:08, 11.40s/it]Processing terminal decisions:  77%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹  | 17/22 [03:55<00:59, 11.85s/it]Processing terminal decisions:  82%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 18/22 [04:08<00:48, 12.15s/it]Processing terminal decisions:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 19/22 [04:15<00:31, 10.50s/it]Processing terminal decisions:  91%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 20/22 [04:21<00:18,  9.31s/it]Processing terminal decisions:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 21/22 [04:33<00:10, 10.05s/it]Processing terminal decisions: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 22/22 [04:40<00:00,  9.30s/it]Processing terminal decisions: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 22/22 [04:40<00:00, 12.77s/it]
ğŸ¯ ç»ˆç«¯å†³ç­–: 164.Mercedes-Benz_E-Class_Sedan_2012_01820.jpg -> Mercedes-Benz E-Class Sedan 2012 (ç½®ä¿¡åº¦: 0.9000, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 123.Geo_Metro_Convertible_1993_00596.jpg -> Geo Metro Convertible 1993 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 163.Mercedes-Benz_SL-Class_Coupe_2009_02723.jpg -> Mercedes-Benz SL-Class Coupe 2009 (ç½®ä¿¡åº¦: 0.9000, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 058.Chevrolet_Traverse_SUV_2012_00692.jpg -> Chevrolet Traverse SUV 2012 (ç½®ä¿¡åº¦: 0.9000, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 134.Hyundai_Sonata_Hybrid_Sedan_2012_04907.jpg -> Hyundai Sonata Hybrid Sedan 2012 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 045.Bugatti_Veyron_16.4_Convertible_2009_04334.jpg -> Bugatti Veyron 16 (ç½®ä¿¡åº¦: 0.9000, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 024.Audi_S4_Sedan_2007_03892.jpg -> Audi S4 Sedan 2007 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 119.GMC_Savana_Van_2012_04214.jpg -> GMC Savana Van 2012 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 174.Ram_C_V_Cargo_Van_Minivan_2012_03611.jpg -> Chrysler Town and Country Minivan 2012 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 144.Jaguar_XK_XKR_2012_06238.jpg -> Jaguar XK XKR 2012 (ç½®ä¿¡åº¦: 0.9000, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 069.Chevrolet_Silverado_2500HD_Regular_Cab_2012_01736.jpg -> Chevrolet Silverado 2500HD Regular Cab 2012 (ç½®ä¿¡åº¦: 0.9000, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 062.Chevrolet_Tahoe_Hybrid_SUV_2012_00823.jpg -> Chevrolet Tahoe Hybrid SUV 2012 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 072.Chevrolet_Monte_Carlo_Coupe_2007_02459.jpg -> Chevrolet Monte Carlo Coupe 2007 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 092.Dodge_Magnum_Wagon_2008_07869.jpg -> Dodge Magnum Wagon 2008 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
æœ€ç»ˆå†³ç­–å¤±è´¥: CUDA out of memory. Tried to allocate 4.96 GiB. GPU 0 has a total capacity of 79.25 GiB of which 2.63 GiB is free. Process 2402405 has 38.31 GiB memory in use. Including non-PyTorch memory, this process has 38.30 GiB memory in use. Of the allocated memory 37.39 GiB is allocated by PyTorch, and 428.46 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
ğŸ¯ ç»ˆç«¯å†³ç­–: 004.Acura_TL_Type-S_2008_02240.jpg -> Acura TL Type-S 2008 02240 (ç½®ä¿¡åº¦: 0.4000, æ­£ç¡®: False)
ğŸ¯ ç»ˆç«¯å†³ç­–: 143.Isuzu_Ascender_SUV_2008_03587.jpg -> Isuzu Ascender SUV 2008 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 060.Chevrolet_HHR_SS_2010_06779.jpg -> Chevrolet HHR SS 2010 (ç½®ä¿¡åº¦: 0.9500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 061.Chevrolet_Impala_Sedan_2007_00676.jpg -> Chevrolet Impala Sedan 2007 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 176.Rolls-Royce_Ghost_Sedan_2012_03914.jpg -> Rolls-Royce Ghost Sedan 2012 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 155.Land_Rover_LR2_SUV_2012_03494.jpg -> Land Rover LR2 SUV 2012 (ç½®ä¿¡åº¦: 0.9500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 091.Dodge_Dakota_Club_Cab_2007_00287.jpg -> Dodge Dakota Club Cab 2007 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
ğŸ¯ ç»ˆç«¯å†³ç­–: 159.Mazda_Tribute_SUV_2011_04866.jpg -> Mazda Tribute SUV 2011 (ç½®ä¿¡åº¦: 0.8500, æ­£ç¡®: True)
âœ… æ€»æ­£ç¡®é¢„æµ‹æ•°: 193
  - å…¶ä¸­ä»…å¿«æ€è€ƒæ­£ç¡®: 85
  - å…¶ä¸­æ…¢æ€è€ƒè§¦å‘ä¸”æ­£ç¡®: 108
âŒ æ€»é”™è¯¯é¢„æµ‹æ•°: 3
ğŸ“Š æ…¢æ€è€ƒè§¦å‘æ•°é‡: 109
[terminal_decision_enhanced] æ€»ä½“å‡†ç¡®ç‡: 0.9847 (193/196)
[terminal_decision_enhanced] å¿«æ€è€ƒå‡†ç¡®ç‡: 0.9770
[terminal_decision_enhanced] æ…¢æ€è€ƒè§¦å‘æ¯”ä¾‹: 0.5561
[terminal_decision_enhanced] æ…¢æ€è€ƒå‡†ç¡®ç‡: 0.9908

============================================================
âœ… ç»ˆç«¯å†³ç­–å¢å¼ºå®Œæˆ
ğŸ“Š æ€»æ ·æœ¬æ•°: 196
ğŸš€ æ€»ä½“å‡†ç¡®ç‡: 0.9847 (193/196)
âš¡ å¿«æ€è€ƒå‡†ç¡®ç‡: 0.9770
ğŸŒ æ…¢æ€è€ƒè§¦å‘æ¯”ä¾‹: 0.5561
ğŸ¯ æ…¢æ€è€ƒå‡†ç¡®ç‡: 0.9908
ğŸ”§ ç»ˆç«¯å†³ç­–æ ·æœ¬æ•°: 22
ğŸ¯ ç»ˆç«¯å†³ç­–æˆåŠŸç‡: 0.9545
============================================================
ğŸ’¾ ç»ˆç«¯å†³ç­–å¢å¼ºç»“æœå·²ä¿å­˜åˆ°: ./experiments/car196/classify/terminal_decision_results_enhanced.json
æ€»è€—æ—¶: 00:04:52

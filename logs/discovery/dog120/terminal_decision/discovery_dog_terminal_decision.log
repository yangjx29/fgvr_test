/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/data/oldhome/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Using a slow image processor as `use_fast` is unset and a slow processor was saved with this model. `use_fast=True` will be the default behavior in v4.48, even if the model was saved with a slow processor. This will result in minor differences in outputs. You'll still be able to use a slow processor with `use_fast=False`.
Namespace(mode='terminal_decision', config_file_env='./configs/env_machine.yml', config_file_expt='./configs/expts/dog120_all.yml', num_per_category='3', knowledge_base_dir='./knowledge_base', query_image=None, test_data_dir=None, results_out='./results.json', use_slow_thinking=None, confidence_threshold=0.8, similarity_threshold=0.7, enable_mllm_intermediate_judge=False, infer_dir='./experiments/dog120/infer', classify_dir='./experiments/dog120/classify')
{'setup': 'ours', 'experiment': 5.0, 'dataset_name': 'dog', 'num_classes': 120, 'num_base': 60, 'num_novel': 60, 'seed': 1, 'batch_size': 256, 'clustering_method': 'multi_clip_voting', 'model_size': 'ViT-B/16', 'model_size_vqa': 'OPT6.7B-COCO', 'model_size_mllm': 'Qwen2.5-VL-7B', 'model_type_llm': 'gpt-3.5-turbo', 'image_size': 224, 'verbose': False, 'host': 'xiao', 'num_workers': 16, 'device': 'cuda', 'device_count': '1', 'device_id': '0', 'data_dir': './datasets/dogs_120', 'expt_dir': './experiments/dog120', 'expt_dir_describe': './experiments/dog120/describe', 'path_vqa_questions': './experiments/dog120/describe/dog_vqa_questions_ours', 'path_vqa_answers': './experiments/dog120/describe/dog_attributes_pairs', 'path_llm_prompts': './experiments/dog120/describe/dog_llm_prompts', 'path_identify_answers': './experiments/dog120/identify', 'expt_dir_guess': './experiments/dog120/guess', 'path_llm_replies_raw': './experiments/dog120/guess/dog_llm_replies_raw', 'path_llm_replies_jsoned': './experiments/dog120/guess/dog_llm_replies_jsoned', 'path_llm_gussed_names': './experiments/dog120/guess/dog_llm_gussed_names', 'expt_dir_gallery': './experiments/dog120/gallery', 'path_references': './experiments/dog120/gallery/dog_image_references', 'path_regions': './experiments/dog120/gallery/dog_image_regions', 'path_descriptions': './experiments/dog120/gallery/dog_image_descriptions_attn', 'expt_dir_grouping': './experiments/dog120/grouping'}
ä»ç›®å½•åŠ è½½æ¨ç†ç»“æœ: ./experiments/dog120/infer
ç»ˆç«¯å†³ç­–ç»“æœå°†ä¿å­˜åˆ°: ./experiments/dog120/classify
åŠ è½½äº† 18 ä¸ªå¿«æ€è€ƒåˆ†ç±»ç»“æœ
åŠ è½½äº† 102 ä¸ªæ…¢æ€è€ƒåˆ†ç±»ç»“æœ
å‘ç° 56 ä¸ªéœ€è¦ç»ˆç«¯å†³ç­–çš„æ ·æœ¬ï¼Œåˆå§‹åŒ–ç³»ç»Ÿ...
åˆå§‹åŒ–çŸ¥è¯†åº“æ„å»ºå™¨...
ğŸš€ èåˆæ–¹æ³•ä¸º 'weighted'ï¼Œè·³è¿‡BLIPæ¨¡å‹åŠ è½½ä»¥èŠ‚çœæ˜¾å­˜
è·å–MLLMæ¨¡å‹å®ä¾‹ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰...
ğŸš€ åˆå§‹åŒ–MLLMæ¨¡å‹: Qwen2.5-VL-7B on cuda
ğŸ“Š å½“å‰æ˜¾å­˜: 0.56GB / 79.25GB
Loading checkpoint shards:   0%|          | 0/5 [00:00<?, ?it/s]Loading checkpoint shards:  20%|â–ˆâ–ˆ        | 1/5 [00:02<00:09,  2.38s/it]Loading checkpoint shards:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 2/5 [00:04<00:07,  2.46s/it]Loading checkpoint shards:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 3/5 [00:07<00:04,  2.42s/it]Loading checkpoint shards:  80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 4/5 [00:09<00:02,  2.42s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5/5 [00:10<00:00,  1.83s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5/5 [00:10<00:00,  2.09s/it]
local_model_path: ./models/Qwen/Qwen2.5-VL-7B-Instruct
âœ… MLLMæ¨¡å‹åˆå§‹åŒ–å®Œæˆ
ğŸ“Š åŠ è½½åæ˜¾å­˜: 31.59GB / 79.25GB
åˆå§‹åŒ–å¿«æ€è€ƒæ¨¡å—...
æœªæ‰¾åˆ°å†å²ç»Ÿè®¡é‡æ–‡ä»¶ï¼Œå°†ä»å¤´å¼€å§‹
åˆå§‹åŒ–æ…¢æ€è€ƒæ¨¡å—...
å¿«æ…¢æ€è€ƒç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ!
ä» ./experiments/dog120/knowledge_base åŠ è½½çŸ¥è¯†åº“...
ç±»åˆ«å›¾åƒè·¯å¾„å·²ä» ./experiments/dog120/knowledge_base/category_image_paths.json åŠ è½½
åŠ è½½äº† 119 ä¸ªç±»åˆ«çš„å›¾åƒè·¯å¾„
çŸ¥è¯†åº“å·²ä» ./experiments/dog120/knowledge_base åŠ è½½
çŸ¥è¯†åº“åŠ è½½å®Œæˆ!
å·²åŠ è½½çŸ¥è¯†åº“: ./experiments/dog120/knowledge_base
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/097.Eskimo_Dog/097.Eskimo_Dog_n02109961_9973.jpg -> Siberian Husky (ç½®ä¿¡åº¦: 0.9000) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/062.Irish_Setter/062.Irish_Setter_n02100877_5286.jpg -> Irish Setter (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/052.West_Highland_White_Terrier/052.West_Highland_White_Terrier_n02098286_1632.jpg -> Miniature Schnauzer (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/096.Saint_Bernard/096.Saint_Bernard_n02109525_18948.jpg -> Saint Bernard (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/106.Samoyed/106.Samoyed_n02111889_6592.jpg -> Samoyed (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/022.Ibizian_Hound/022.Ibizian_Hound_n02091244_5818.jpg -> Basenji (ç½®ä¿¡åº¦: 0.9000) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/015.Walker_Hound/015.Walker_Hound_n02089867_24.jpg -> Bluetick Coonhound (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/082.Bouvier_des_Flandres/082.Bouvier_des_Flandres_n02106382_1151.jpg -> Bouvier des Flandres (ç½®ä¿¡åº¦: 0.9000) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/038.Lakeland_Terrier/038.Lakeland_Terrier_n02095570_4782.jpg -> Kerry Blue Terrier (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/025.Saluki/025.Saluki_n02091831_11021.jpg -> Saluki (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/100.Affenpinscher/100.Affenpinscher_n02110627_10439.jpg -> Brussels Griffon (ç½®ä¿¡åº¦: 0.8000) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/066.English_Springer_Spaniel/066.English_Springer_Spaniel_n02102040_5096.jpg -> English Springer Spaniel (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/005.Blenheim_Spaniel/005.Blenheim_Spaniel_n02086646_3986.jpg -> Blenheim Cavalier King Charles Spaniel (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/016.English_Foxhound/016.English_Foxhound_n02089973_1907.jpg -> Beagle and Foxhound (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/069.Sussex_Spaniel/069.Sussex_Spaniel_n02102480_5703.jpg -> American Cocker Spaniel (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/078.Old_English_Sheepdog/078.Old_English_Sheepdog_n02105641_3531.jpg -> Old English Sheepdog (ç½®ä¿¡åº¦: 0.9000) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/017.Redbone/017.Redbone_n02090379_3996.jpg -> Rhodesian Ridgeback (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/000.Chihuaha/000.Chihuaha_n02085620_3488.jpg -> Chihuahua (ç½®ä¿¡åº¦: 0.9000) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/063.Gordon_Setter/063.Gordon_Setter_n02101006_2540.jpg -> Gordon Setter (ç½®ä¿¡åº¦: 0.9500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/072.Schipperke/072.Schipperke_n02104365_6140.jpg -> Chihuahua (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/098.Malamute/098.Malamute_n02110063_12514.jpg -> Siberian Husky (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/115.Standard_Poodle/115.Standard_Poodle_n02113799_1537.jpg -> Standard Poodle (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/029.American_Staffordshire_Terrier/029.American_Staffordshire_Terrier_n02093428_3353.jpg -> American Staffordshire Terrier (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/085.Doberman/085.Doberman_n02107142_4763.jpg -> Doberman (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/021.Whippet/021.Whippet_n02091134_15784.jpg -> Whippet (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/033.Irish_Terrier/033.Irish_Terrier_n02093991_1276.jpg -> Irish Terrier (ç½®ä¿¡åº¦: 0.9500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/067.Welsh_Springer_Spaniel/067.Welsh_Springer_Spaniel_n02102177_1128.jpg -> Welsh Springer Spaniel (ç½®ä¿¡åº¦: 0.7500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/089.Appenzeller/089.Appenzeller_n02107908_7236.jpg -> EntleBucher (ç½®ä¿¡åº¦: 0.7500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/057.Labrador_Retriever/057.Labrador_Retriever_n02099712_3613.jpg -> German Short-haired Pointer (ç½®ä¿¡åº¦: 0.8000) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/043.Dandi_Dinmont/043.Dandi_Dinmont_n02096437_730.jpg -> Soft-coated Wheaten Terrier (ç½®ä¿¡åº¦: 0.8000) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/048.Scotch_Terrier/048.Scotch_Terrier_n02097298_2443.jpg -> Scottish Terrier (ç½®ä¿¡åº¦: 0.9000) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/012.Bloodhound/012.Bloodhound_n02088466_4731.jpg -> Bloodhound (ç½®ä¿¡åº¦: 0.9000) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/006.Papillon/006.Papillon_n02086910_4388.jpg -> Japanese Chin (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/101.Basenji/101.Basenji_n02110806_4876.jpg -> Basenji and Corgi (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/060.Vizsla/060.Vizsla_n02100583_6521.jpg -> Bloodhound (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/007.Toy_Terrier/007.Toy_Terrier_n02087046_4402.jpg -> Toy Terrier (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/076.Kelpie/076.Kelpie_n02105412_5288.jpg -> Kelpie (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/053.Lhasa/053.Lhasa_n02098413_3033.jpg -> Shih-Tzu (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/108.Chow/108.Chow_n02112137_14448.jpg -> Chow (ç½®ä¿¡åº¦: 0.9000) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/054.Flat_coated_Retriever/054.Flat_coated_Retriever_n02099267_5540.jpg -> Flat-coated Retriever (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/037.Wirehaired_Fox_Terrier/037.Wirehaired_Fox_Terrier_n02095314_3512.jpg -> Sealyham Terrier (ç½®ä¿¡åº¦: 0.8000) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/051.Soft_coated_Wheaten_Terrier/051.Soft_coated_Wheaten_Terrier_n02098105_838.jpg -> Soft-coated Wheaten Terrier (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/080.Collie/080.Collie_n02106030_10057.jpg -> Rough Collie (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/040.Airedale/040.Airedale_n02096051_8826.jpg -> Airedale Terrier (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/091.Boxer/091.Boxer_n02108089_14719.jpg -> Boxer (ç½®ä¿¡åº¦: 0.9000) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/049.Tibetan_Terrier/049.Tibetan_Terrier_n02097474_5841.jpg -> Soft-coated Wheaten Terrier (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/093.Tibetan_Mastiff/093.Tibetan_Mastiff_n02108551_7523.jpg -> Great Pyrenees (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/068.Cocker_Spaniel/068.Cocker_Spaniel_n02102318_6612.jpg -> Airedale (ç½®ä¿¡åº¦: 0.8000) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/010.Basset_Hound/010.Basset_Hound_n02088238_7181.jpg -> Basset Hound (ç½®ä¿¡åº¦: 0.9000) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/030.Bedlington_Terrier/030.Bedlington_Terrier_n02093647_79.jpg -> Bedlington Terrier (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/064.Brittany/064.Brittany_n02101388_4229.jpg -> Brittany Spaniel (ç½®ä¿¡åº¦: 0.9000) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/090.EntleBucher/090.EntleBucher_n02108000_716.jpg -> EntleBucher (ç½®ä¿¡åº¦: 0.9000) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/073.Groenendael/073.Groenendael_n02105056_7068.jpg -> Schipperke (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/105.Great_Pyrenees/105.Great_Pyrenees_n02111500_5052.jpg -> Great Pyrenees (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/116.Mexican_Hairless/116.Mexican_Hairless_n02113978_2888.jpg -> Mexican Hairless (ç½®ä¿¡åº¦: 0.8000) æ­£ç¡®: True
ç»ˆç«¯å†³ç­–: ./datasets/dogs_120/images_discovery_all_1/046.Giant_Schnauzer/046.Giant_Schnauzer_n02097130_5907.jpg -> Scottish Terrier (Scottie) and Bouvier des Flandres (ç½®ä¿¡åº¦: 0.8500) æ­£ç¡®: False
âœ… æ€»æ­£ç¡®é¢„æµ‹æ•°: 92
  - å…¶ä¸­ä»…å¿«æ€è€ƒæ­£ç¡®: 17
  - å…¶ä¸­æ…¢æ€è€ƒè§¦å‘ä¸”æ­£ç¡®: 75
âŒ æ€»é”™è¯¯é¢„æµ‹æ•°: 28
ğŸ“Š æ…¢æ€è€ƒè§¦å‘æ•°é‡: 102
[terminal_decision] æ€»ä½“å‡†ç¡®ç‡: 0.7667 (92/120)
[terminal_decision] å¿«æ€è€ƒå‡†ç¡®ç‡: 0.9444
[terminal_decision] æ…¢æ€è€ƒè§¦å‘æ¯”ä¾‹: 0.8500
[terminal_decision] æ…¢æ€è€ƒå‡†ç¡®ç‡: 0.7353
ç»ˆç«¯å†³ç­–ç»“æœå·²ä¿å­˜åˆ°: ./experiments/dog120/classify/terminal_decision_results.json
æ€»è€—æ—¶: 00:11:29

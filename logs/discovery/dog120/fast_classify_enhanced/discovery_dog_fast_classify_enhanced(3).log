/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/data/oldhome/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Namespace(mode='fast_classify_enhanced', config_file_env='./configs/env_machine.yml', config_file_expt='./configs/expts/dog120_all.yml', num_per_category='3', knowledge_base_dir='./knowledge_base', query_image=None, test_data_dir=None, results_out='./results.json', use_slow_thinking=None, confidence_threshold=0.8, similarity_threshold=0.7, enable_mllm_intermediate_judge=False, infer_dir='./experiments/dog120/infer', classify_dir='./experiments/dog120/classify')
{'setup': 'ours', 'experiment': 5.0, 'dataset_name': 'dog', 'num_classes': 120, 'num_base': 60, 'num_novel': 60, 'seed': 1, 'batch_size': 256, 'clustering_method': 'multi_clip_voting', 'model_size': 'ViT-B/16', 'model_size_vqa': 'OPT6.7B-COCO', 'model_size_mllm': 'Qwen2.5-VL-7B', 'model_type_llm': 'gpt-3.5-turbo', 'image_size': 224, 'verbose': False, 'host': 'xiao', 'num_workers': 16, 'device': 'cuda', 'device_count': '1', 'device_id': '0', 'data_dir': './datasets/dogs_120', 'expt_dir': './experiments/dog120', 'expt_dir_describe': './experiments/dog120/describe', 'path_vqa_questions': './experiments/dog120/describe/dog_vqa_questions_ours', 'path_vqa_answers': './experiments/dog120/describe/dog_attributes_pairs', 'path_llm_prompts': './experiments/dog120/describe/dog_llm_prompts', 'path_identify_answers': './experiments/dog120/identify', 'expt_dir_guess': './experiments/dog120/guess', 'path_llm_replies_raw': './experiments/dog120/guess/dog_llm_replies_raw', 'path_llm_replies_jsoned': './experiments/dog120/guess/dog_llm_replies_jsoned', 'path_llm_gussed_names': './experiments/dog120/guess/dog_llm_gussed_names', 'expt_dir_gallery': './experiments/dog120/gallery', 'path_references': './experiments/dog120/gallery/dog_image_references', 'path_regions': './experiments/dog120/gallery/dog_image_regions', 'path_descriptions': './experiments/dog120/gallery/dog_image_descriptions_attn', 'expt_dir_grouping': './experiments/dog120/grouping'}
ä»ç›®å½•åŠ è½½æ¨ç†ç»“æœ: ./experiments/dog120/infer
å¢å¼ºå¿«æ€è€ƒåˆ†ç±»ç»“æœå°†ä¿å­˜åˆ°: ./experiments/dog120/classify
æ‰¾åˆ° 152 ä¸ªæ¨ç†ç»“æœæ–‡ä»¶
âœ… ä»çŸ¥è¯†åº“åŠ è½½äº† 119 ä¸ªç±»åˆ«çš„å›¾åƒè·¯å¾„: ./experiments/dog120/knowledge_base/category_image_paths.json
âœ… æˆåŠŸåŠ è½½ç±»åˆ«å›¾åƒè·¯å¾„ï¼ŒåŒ…å« 119 ä¸ªç±»åˆ«
ğŸ”§ å¿«æ€è€ƒæ¨¡å¼ï¼šå¯ç”¨åŠ¨æ€kå¼ å›¾åƒçš„AWCå¤„ç†
ğŸ“Š kå€¼åˆ†å¸ƒç»Ÿè®¡: {4: 118, 8: 1}
ğŸ“Š å¹³å‡æ¯ç±»åˆ«å›¾åƒæ•°: 4.0
ğŸ“Š æ€»å›¾åƒæ•°: 480
æ”¶é›†å¿«æ€è€ƒæ ·æœ¬...
Collecting fast samples:   0%|          | 0/152 [00:00<?, ?it/s]Collecting fast samples: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 152/152 [00:00<00:00, 12868.82it/s]
ğŸ“Š æ”¶é›†åˆ° 22 ä¸ªå¿«æ€è€ƒæ ·æœ¬
ğŸ“Š éœ€è¦æ£€ç´¢ 64 ä¸ªç±»åˆ«
å‡†å¤‡æµ‹è¯•å›¾åƒ...
Copying test images:   0%|          | 0/22 [00:00<?, ?it/s]Copying test images: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 22/22 [00:00<00:00, 10275.58it/s]
å‡†å¤‡æ£€ç´¢å›¾åƒ...
Preparing retrieved images:   0%|          | 0/64 [00:00<?, ?it/s]Preparing retrieved images: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 64/64 [00:00<00:00, 2198.33it/s]
ğŸ” ç±»åˆ« Bull Mastiff: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Eskimo Dog: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Keeshond: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Lhasa: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Pembroke: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Briard: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Pomeranian: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Tibetan Terrier: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Toy Poodle: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Chesapeake Bay Retriever: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Basset Hound: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Scottish Deerhound: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Norwegian Elkhound: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Norfolk Terrier: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« English Setter: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Komondor: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Flat-coated Retriever: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Brabancon Griffon: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Kelpie: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Bloodhound: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« English Springer Spaniel: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Brittany: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Border Terrier: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Malinois: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« African Hunting Dog: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Afghan Hound: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Appenzeller: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« American Staffordshire Terrier: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Boxer: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Soft-coated Wheaten Terrier: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Collie: æ£€æµ‹åˆ° 8 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Saluki: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Clumber: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Groenendael: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Dingo: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Japanese Spaniel: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Shetland Sheepdog: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Schipperke: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Affenpinscher: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« French Bulldog: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Labrador Retriever: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Cardigan: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Borzoi: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Boston Bull: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Shih-Tzu: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Miniature Poodle: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Pug: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Irish Wolfhound: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Basenji: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« German Shepard: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Airedale: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Dhole: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Cairn: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Irish Terrier: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« German Short-haired Pointer: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Weimaraner: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Vizsla: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Italian Greyhound: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Saint Bernard: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Chow: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Leonberg: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Staffordshire Bullterrier: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Lakeland Terrier: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ” ç±»åˆ« Pekinese: æ£€æµ‹åˆ° 4 å¼ å›¾åƒ
ğŸ“ ä¿å­˜æè¿°æ–‡ä»¶åˆ°: ./Multimodal_Enhanced_Classification/descriptions/dog120_fast_test_descriptions.json
ğŸ“ ä¿å­˜æè¿°æ–‡ä»¶åˆ°: ./Multimodal_Enhanced_Classification/descriptions/dog120_fast_retrieved_descriptions.json
ğŸš€ è°ƒç”¨MECå®Œæ•´æµæ°´çº¿ï¼ˆè¿”å›è¯¦ç»†AWCä¿¡æ¯ï¼‰...
ğŸ” éªŒè¯æ•°æ®å®Œæ•´æ€§...
  æµ‹è¯•æ•°æ®ç›®å½•: ./Multimodal_Enhanced_Classification/data/dog120_fast_test
  æ£€ç´¢æ•°æ®ç›®å½•: ./Multimodal_Enhanced_Classification/data/dog120_fast_retrieved
  æ£€ç´¢å›¾åƒä½äºå­ç›®å½•: ./Multimodal_Enhanced_Classification/data/dog120_fast_retrieved/retrieved_images
  å‘ç°æµ‹è¯•å›¾åƒ: 22 ä¸ª
  å‘ç°æ£€ç´¢å›¾åƒ: 260 ä¸ª
MECæµæ°´çº¿: æµ‹è¯•æ ·æœ¬ 22 ä¸ª, æ£€ç´¢æ ·æœ¬ 260 ä¸ª
ğŸ”„ æ­¥éª¤1: é¢„æå–å¤šæ¨¡æ€ç‰¹å¾...
æ‰§è¡Œé¢„æå–å‘½ä»¤: /home/hdl/miniconda3/envs/finer_dynamic/bin/python pre_extract.py ./Multimodal_Enhanced_Classification/data --test_set dog120_fast --arch ViT-B/16 --seed 0 --batch-size 50 --workers 4 --resolution 224
âŒ ç‰¹å¾é¢„æå–å¤±è´¥:
stdout: ğŸš€ å¼€å§‹MECç‰¹å¾é¢„æå–: dog120_fast
ğŸ“ æ¨¡å‹æ¶æ„: ViT-B/16
ğŸ² éšæœºç§å­: 0
ğŸ”„ åŠ è½½CLIPæ¨¡å‹...
âœ… CLIPæ¨¡å‹åŠ è½½æˆåŠŸ
ğŸ”„ æ„å»ºæ•°æ®é›†: dog120_fast
ğŸ”„ å¤„ç†åŠ¨æ€æ•°æ®é›†: dog120_fast_retrieved
ğŸ“ ç›®æ ‡ç›®å½•: ./Multimodal_Enhanced_Classification/data/dog120_fast_retrieved
âœ… æ‰¾åˆ°æ•°æ®é›†ç›®å½•: ./Multimodal_Enhanced_Classification/data/dog120_fast_retrieved
âœ… æˆåŠŸåŠ è½½æ•°æ®é›†: 1 ä¸ªæ ·æœ¬, 1 ä¸ªç±»åˆ«
ğŸ”„ å¤„ç†åŠ¨æ€æ•°æ®é›†: dog120_fast_test
ğŸ“ ç›®æ ‡ç›®å½•: ./Multimodal_Enhanced_Classification/data/dog120_fast_test
âœ… æ‰¾åˆ°æ•°æ®é›†ç›®å½•: ./Multimodal_Enhanced_Classification/data/dog120_fast_test
âœ… æˆåŠŸåŠ è½½æ•°æ®é›†: 1 ä¸ªæ ·æœ¬, 1 ä¸ªç±»åˆ«
ğŸ“Š æ£€ç´¢æ ·æœ¬æ•°é‡: 1
ğŸ“Š æµ‹è¯•æ ·æœ¬æ•°é‡: 1
ğŸ”„ åˆ›å»ºæ•°æ®åŠ è½½å™¨...
âœ… æ•°æ®åŠ è½½å™¨åˆ›å»ºæˆåŠŸ
ğŸš€ å¼€å§‹æå–å¤šæ¨¡æ€ç‰¹å¾...
æ£€æŸ¥æè¿°æ–‡ä»¶:
  æ£€ç´¢æè¿°: ./descriptions/dog120_fast_retrieved_descriptions.json
  æµ‹è¯•æè¿°: ./descriptions/dog120_fast_test_descriptions.json
âœ… æˆåŠŸåŠ è½½æè¿°æ–‡ä»¶:
  æ£€ç´¢æè¿°: 1 æ¡
  æµ‹è¯•æè¿°: 1 æ¡
ğŸ”„ å¤„ç†æ£€ç´¢å›¾åƒ-æ–‡æœ¬å¯¹ï¼ˆæ”¯æŒæ¯ç±»åˆ«kå¼ å›¾åƒï¼‰...
âŒ å¤„ç†æ£€ç´¢å›¾åƒå¤±è´¥: 'list' object has no attribute 'keys'
âŒ MECç‰¹å¾é¢„æå–å¤±è´¥!
âŒ ç‰¹å¾é¢„æå–å¤±è´¥

stderr: /home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/data/oldhome/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(

Processing retrieved:   0%|          | 0/1 [00:00<?, ?it/s]/data/oldhome/hdl/project/fvgr/fgvr_test/Multimodal_Enhanced_Classification/pre_extract.py:150: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():

Processing retrieved:   0%|          | 0/1 [00:00<?, ?it/s]

âŒ MECæµæ°´çº¿å¤±è´¥: ç‰¹å¾é¢„æå–å¤±è´¥
å¤„ç†å¢å¼ºç»“æœ...
Processing enhanced results:   0%|          | 0/22 [00:00<?, ?it/s]Processing enhanced results: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 22/22 [00:00<00:00, 6124.70it/s]
ğŸ—‘ï¸  å·²æ¸…ç†ä¸´æ—¶ç›®å½•: ./Multimodal_Enhanced_Classification/data/dog120_fast_test
ğŸ—‘ï¸  å·²æ¸…ç†ä¸´æ—¶ç›®å½•: ./Multimodal_Enhanced_Classification/data/dog120_fast_retrieved
ğŸ—‘ï¸  å·²æ¸…ç†æè¿°æ–‡ä»¶: ./Multimodal_Enhanced_Classification/descriptions/dog120_fast_test_descriptions.json
ğŸ—‘ï¸  å·²æ¸…ç†æè¿°æ–‡ä»¶: ./Multimodal_Enhanced_Classification/descriptions/dog120_fast_retrieved_descriptions.json
âœ… å¿«æ€è€ƒå¢å¼ºåˆ†ç±»å®Œæˆ
ğŸ“Š æ€»æ ·æœ¬æ•°: 22
ğŸš€ æœ€ç»ˆå‡†ç¡®ç‡: 0.9545 (21/22)
ğŸ”§ MECæ‰§è¡ŒçŠ¶æ€: å¤±è´¥
ğŸ’¾ å¢å¼ºå¿«æ€è€ƒåˆ†ç±»ç»“æœå·²ä¿å­˜åˆ°: ./experiments/dog120/classify/fast_classification_results_enhanced.json
æ€»è€—æ—¶: 00:00:07

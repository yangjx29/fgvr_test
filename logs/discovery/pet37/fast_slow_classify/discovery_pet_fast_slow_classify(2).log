/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/data/oldhome/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Using a slow image processor as `use_fast` is unset and a slow processor was saved with this model. `use_fast=True` will be the default behavior in v4.48, even if the model was saved with a slow processor. This will result in minor differences in outputs. You'll still be able to use a slow processor with `use_fast=False`.
Namespace(mode='fast_slow_classify', config_file_env='./configs/env_machine.yml', config_file_expt='./configs/expts/pet37_all.yml', num_per_category='3', knowledge_base_dir='./knowledge_base', query_image=None, test_data_dir=None, results_out='./results.json', use_slow_thinking=None, confidence_threshold=0.8, similarity_threshold=0.7, enable_mllm_intermediate_judge=False, infer_dir='./experiments/pet37/infer', classify_dir='./experiments/pet37/classify')
{'setup': 'ours', 'experiment': 5.0, 'dataset_name': 'pet', 'num_classes': 37, 'num_base': 19, 'num_novel': 18, 'seed': 1, 'batch_size': 32, 'clustering_method': 'multi_clip_voting', 'model_size': 'ViT-B/16', 'model_size_vqa': 'FlanT5-XXL', 'model_size_mllm': 'Qwen2.5-VL-7B', 'model_type_llm': 'gpt-3.5-turbo', 'image_size': 224, 'verbose': False, 'host': 'xiao', 'num_workers': 16, 'device': 'cuda', 'device_count': '1', 'device_id': '0', 'data_dir': './datasets/pet_37', 'expt_dir': './experiments/pet37', 'expt_dir_describe': './experiments/pet37/describe', 'path_vqa_questions': './experiments/pet37/describe/pet_vqa_questions_ours', 'path_vqa_answers': './experiments/pet37/describe/pet_attributes_pairs', 'path_llm_prompts': './experiments/pet37/describe/pet_llm_prompts', 'path_identify_answers': './experiments/pet37/identify', 'expt_dir_guess': './experiments/pet37/guess', 'path_llm_replies_raw': './experiments/pet37/guess/pet_llm_replies_raw', 'path_llm_replies_jsoned': './experiments/pet37/guess/pet_llm_replies_jsoned', 'path_llm_gussed_names': './experiments/pet37/guess/pet_llm_gussed_names', 'expt_dir_gallery': './experiments/pet37/gallery', 'path_references': './experiments/pet37/gallery/pet_image_references', 'path_regions': './experiments/pet37/gallery/pet_image_regions', 'path_descriptions': './experiments/pet37/gallery/pet_image_descriptions_attn', 'expt_dir_grouping': './experiments/pet37/grouping'}
å½“å‰æ—¶é—´ä¸ºï¼š 2025-11-01 10:26:37
ä»ç›®å½•åŠ è½½æ¨ç†ç»“æœ: ./experiments/pet37/infer
åˆ†ç±»ç»“æœå°†ä¿å­˜åˆ°: ./experiments/pet37/classify
åˆå§‹åŒ–çŸ¥è¯†åº“æ„å»ºå™¨...
ğŸš€ èåˆæ–¹æ³•ä¸º 'weighted'ï¼Œè·³è¿‡BLIPæ¨¡å‹åŠ è½½ä»¥èŠ‚çœæ˜¾å­˜
è·å–MLLMæ¨¡å‹å®ä¾‹ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰...
ğŸš€ åˆå§‹åŒ–MLLMæ¨¡å‹: Qwen2.5-VL-7B on cuda
ğŸ“Š å½“å‰æ˜¾å­˜: 0.56GB / 47.40GB
Loading checkpoint shards:   0%|          | 0/5 [00:00<?, ?it/s]Loading checkpoint shards:  20%|â–ˆâ–ˆ        | 1/5 [00:01<00:06,  1.66s/it]Loading checkpoint shards:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 2/5 [00:03<00:05,  1.94s/it]Loading checkpoint shards:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 3/5 [00:05<00:03,  1.99s/it]Loading checkpoint shards:  80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 4/5 [00:07<00:02,  2.02s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5/5 [00:08<00:00,  1.57s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5/5 [00:08<00:00,  1.74s/it]
local_model_path: ./models/Qwen/Qwen2.5-VL-7B-Instruct
âœ… MLLMæ¨¡å‹åˆå§‹åŒ–å®Œæˆ
ğŸ“Š åŠ è½½åæ˜¾å­˜: 31.59GB / 47.40GB
åˆå§‹åŒ–å¿«æ€è€ƒæ¨¡å—...
æœªæ‰¾åˆ°å†å²ç»Ÿè®¡é‡æ–‡ä»¶ï¼Œå°†ä»å¤´å¼€å§‹
åˆå§‹åŒ–æ…¢æ€è€ƒæ¨¡å—...
å¿«æ…¢æ€è€ƒç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ!
ä» ./experiments/pet37/knowledge_base åŠ è½½çŸ¥è¯†åº“...
ç±»åˆ«å›¾åƒè·¯å¾„å·²ä» ./experiments/pet37/knowledge_base/category_image_paths.json åŠ è½½
åŠ è½½äº† 37 ä¸ªç±»åˆ«çš„å›¾åƒè·¯å¾„
çŸ¥è¯†åº“å·²ä» ./experiments/pet37/knowledge_base åŠ è½½
çŸ¥è¯†åº“åŠ è½½å®Œæˆ!
å·²åŠ è½½çŸ¥è¯†åº“: ./experiments/pet37/knowledge_base
æ‰¾åˆ° 399 ä¸ªæ¨ç†ç»“æœæ–‡ä»¶
Processing classification:   0%|          | 0/399 [00:00<?, ?it/s]Processing classification:   2%|â–         | 6/399 [00:10<11:18,  1.73s/it]Processing classification:   3%|â–         | 11/399 [00:20<12:14,  1.89s/it]Processing classification:   5%|â–         | 18/399 [00:30<10:22,  1.64s/it]Processing classification:   6%|â–Œ         | 22/399 [00:40<12:03,  1.92s/it]Processing classification:   7%|â–‹         | 28/399 [00:51<11:39,  1.89s/it]Processing classification:   7%|â–‹         | 29/399 [00:59<14:53,  2.42s/it]Processing classification:  10%|â–‰         | 39/399 [01:08<09:19,  1.55s/it]Processing classification:  13%|â–ˆâ–        | 52/399 [01:17<06:28,  1.12s/it]Processing classification:  13%|â–ˆâ–        | 53/399 [01:25<08:36,  1.49s/it]Processing classification:  14%|â–ˆâ–        | 55/399 [01:35<11:03,  1.93s/it]Processing classification:  17%|â–ˆâ–‹        | 69/399 [01:45<06:54,  1.25s/it]Processing classification:  18%|â–ˆâ–Š        | 72/399 [01:55<08:29,  1.56s/it]Processing classification:  20%|â–ˆâ–‰        | 79/399 [02:04<07:45,  1.45s/it]Processing classification:  22%|â–ˆâ–ˆâ–       | 88/399 [02:14<06:52,  1.32s/it]Processing classification:  23%|â–ˆâ–ˆâ–       | 90/399 [02:22<08:26,  1.64s/it]Processing classification:  28%|â–ˆâ–ˆâ–Š       | 113/399 [02:36<04:38,  1.03it/s]Processing classification:  35%|â–ˆâ–ˆâ–ˆâ–      | 138/399 [02:46<03:00,  1.44it/s]Processing classification:  35%|â–ˆâ–ˆâ–ˆâ–      | 139/399 [02:56<04:04,  1.06it/s]Processing classification:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 144/399 [03:06<04:49,  1.14s/it]Processing classification:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 146/399 [03:15<05:55,  1.41s/it]Processing classification:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 150/399 [03:19<05:26,  1.31s/it]Processing classification:  45%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 179/399 [03:27<02:16,  1.62it/s]Processing classification:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 193/399 [03:35<02:05,  1.64it/s]Processing classification:  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 213/399 [03:46<01:47,  1.72it/s]Processing classification:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 229/399 [03:55<01:40,  1.70it/s]Processing classification:  59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 236/399 [04:04<01:54,  1.42it/s]Processing classification:  62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 246/399 [04:14<01:56,  1.32it/s]Processing classification:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 253/399 [04:24<02:10,  1.12it/s]Processing classification:  66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 262/399 [04:31<02:01,  1.13it/s]Processing classification:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 266/399 [04:40<02:22,  1.07s/it]Processing classification:  68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 270/399 [04:50<02:47,  1.30s/it]Processing classification:  68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 272/399 [04:59<03:33,  1.68s/it]Processing classification:  69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 275/399 [05:10<04:11,  2.03s/it]Processing classification:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 280/399 [05:19<03:56,  1.98s/it]Processing classification:  71%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 282/399 [05:31<04:57,  2.54s/it]Processing classification:  72%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 286/399 [05:40<04:37,  2.46s/it]Processing classification:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 304/399 [05:48<01:48,  1.15s/it]Processing classification:  77%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹  | 308/399 [05:57<02:00,  1.33s/it]Processing classification:  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 313/399 [06:05<02:00,  1.41s/it]Processing classification:  82%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 328/399 [06:14<01:10,  1.00it/s]Processing classification:  84%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 334/399 [06:24<01:13,  1.13s/it]Processing classification:  84%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 336/399 [06:34<01:36,  1.54s/it]Processing classification:  85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 338/399 [06:44<01:58,  1.94s/it]Processing classification:  85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 339/399 [06:55<02:38,  2.64s/it]Processing classification:  88%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 351/399 [07:05<01:17,  1.61s/it]Processing classification:  96%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 382/399 [07:15<00:12,  1.35it/s]Processing classification:  97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 386/399 [07:24<00:11,  1.11it/s]Processing classification:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 391/399 [07:34<00:08,  1.09s/it]Processing classification:  99%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰| 395/399 [07:45<00:05,  1.33s/it]Processing classification: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 399/399 [07:45<00:00,  1.17s/it]
å¿«æ…¢ä¸ä¸€è‡´: fast=Birman, slow=Siamese, è£å†³ç»“æœ=Siamese
å¿«æ…¢ä¸ä¸€è‡´: fast=Bombay, slow=Maine Coon, è£å†³ç»“æœ=Siamese
å¿«æ…¢ä¸ä¸€è‡´: fast=Boxer, slow=Saint Bernard, è£å†³ç»“æœ=Saint Bernard
å¿«æ…¢ä¸ä¸€è‡´: fast=Wheaten Terrier, slow=Havanese, è£å†³ç»“æœ=Lhasa Apso
å¿«æ…¢ä¸ä¸€è‡´: fast=Bengal, slow=Maine Coon, è£å†³ç»“æœ=Maine Coon
å¿«æ…¢ä¸ä¸€è‡´: fast=Ragdoll, slow=Maine Coon, è£å†³ç»“æœ=Ragdoll
å¿«æ…¢ä¸ä¸€è‡´: fast=British Shorthair, slow=Scottish Fold, è£å†³ç»“æœ=Scottish Fold
å¿«æ…¢ä¸ä¸€è‡´: fast=Abyssinian, slow=Sphynx, è£å†³ç»“æœ=Sphynx
å¿«æ…¢ä¸ä¸€è‡´: fast=Basset Hound, slow=Beagle, è£å†³ç»“æœ=Beagle
å¿«æ…¢ä¸ä¸€è‡´: fast=Birman, slow=Ragdoll, è£å†³ç»“æœ=Ragdoll
å¿«æ…¢ä¸ä¸€è‡´: fast=Keeshond, slow=Great Pyrenees, è£å†³ç»“æœ=Great Pyrenees
å¿«æ…¢ä¸ä¸€è‡´: fast=Ragdoll, slow=Birman, è£å†³ç»“æœ=Birman
å¿«æ…¢ä¸ä¸€è‡´: fast=Abyssinian, slow=Bengal, è£å†³ç»“æœ=Bengal
å¿«æ…¢ä¸ä¸€è‡´: fast=German Shorthaired, slow=Poodle or Poodle Mix, è£å†³ç»“æœ=English Cocker Spaniel
å¿«æ…¢ä¸ä¸€è‡´: fast=Keeshond, slow=Pomeranian, è£å†³ç»“æœ=Pomeranian
å¿«æ…¢ä¸ä¸€è‡´: fast=Ragdoll, slow=Siamese or Siamese Mix, è£å†³ç»“æœ=Siamese or Siamese Mix
å¿«æ…¢ä¸ä¸€è‡´: fast=Havanese, slow=Shih Tzu, è£å†³ç»“æœ=Havanese
å¿«æ…¢ä¸ä¸€è‡´: fast=Havanese, slow=Wheaten Terrier, è£å†³ç»“æœ=Scottish Terrier
å¿«æ…¢ä¸ä¸€è‡´: fast=Basset Hound, slow=Saint Bernard, è£å†³ç»“æœ=Saint Bernard
å¿«æ…¢ä¸ä¸€è‡´: fast=Chihuahua, slow=Boxer, è£å†³ç»“æœ=Boxer
æœ€ç»ˆå†³ç­–å¤±è´¥: CUDA out of memory. Tried to allocate 37.03 GiB. GPU 0 has a total capacity of 47.40 GiB of which 10.88 GiB is free. Including non-PyTorch memory, this process has 36.51 GiB memory in use. Of the allocated memory 35.79 GiB is allocated by PyTorch, and 416.80 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
å¿«æ…¢ä¸ä¸€è‡´: fast=Bengal, slow=Maine Coon, è£å†³ç»“æœ=Maine Coon
å¿«æ…¢ä¸ä¸€è‡´: fast=Great Pyrenees, slow=Golden Retriever, è£å†³ç»“æœ=Great Pyrenees
å¿«æ…¢ä¸ä¸€è‡´: fast=American Bulldog, slow=Boxer, è£å†³ç»“æœ=Boxer
å¿«æ…¢ä¸ä¸€è‡´: fast=Bombay, slow=British Shorthair, è£å†³ç»“æœ=British Shorthair
å¿«æ…¢ä¸ä¸€è‡´: fast=Ragdoll, slow=Siamese, è£å†³ç»“æœ=Siamese
å¿«æ…¢ä¸ä¸€è‡´: fast=Bombay, slow=Black Cat, è£å†³ç»“æœ=Russian Blue
å¿«æ…¢ä¸ä¸€è‡´: fast=Birman, slow=Siamese, è£å†³ç»“æœ=Birman
å¿«æ…¢ä¸ä¸€è‡´: fast=Egyptian Mau, slow=British Shorthair, è£å†³ç»“æœ=Egyptian Mau
å¿«æ…¢ä¸ä¸€è‡´: fast=Samoyed, slow=Pomeranian, è£å†³ç»“æœ=Pomeranian
å¿«æ…¢ä¸ä¸€è‡´: fast=Miniature Pinscher, slow=Chihuahua, è£å†³ç»“æœ=Chihuahua
å¿«æ…¢ä¸ä¸€è‡´: fast=Leonberger, slow=German Shepherd, è£å†³ç»“æœ=German Shepherd
å¿«æ…¢ä¸ä¸€è‡´: fast=Russian Blue, slow=British Shorthair, è£å†³ç»“æœ=British Shorthair
å¿«æ…¢ä¸ä¸€è‡´: fast=Scottish Terrier, slow=West Highland White Terrier (Westie), è£å†³ç»“æœ=West Highland White Terrier (Westie)
å¿«æ…¢ä¸ä¸€è‡´: fast=Pug, slow=Shiba Inu, è£å†³ç»“æœ=Shiba Inu
å¿«æ…¢ä¸ä¸€è‡´: fast=Chihuahua, slow=Beagle, è£å†³ç»“æœ=Beagle
å¿«æ…¢ä¸ä¸€è‡´: fast=German Shorthaired, slow=English Setter, è£å†³ç»“æœ=English Setter
å¿«æ…¢ä¸ä¸€è‡´: fast=Ragdoll, slow=Maine Coon, è£å†³ç»“æœ=Siamese
å¿«æ…¢ä¸ä¸€è‡´: fast=Wheaten Terrier, slow=English Cocker Spaniel, è£å†³ç»“æœ=English Cocker Spaniel
å¿«æ…¢ä¸ä¸€è‡´: fast=Egyptian Mau, slow=Bengal, è£å†³ç»“æœ=Bengal
å¿«æ…¢ä¸ä¸€è‡´: fast=American Bulldog, slow=Boxer, è£å†³ç»“æœ=Boxer
å¿«æ…¢ä¸ä¸€è‡´: fast=Ragdoll, slow=Birman, è£å†³ç»“æœ=Ragdoll
å¿«æ…¢ä¸ä¸€è‡´: fast=English Setter, slow=Cocker Spaniel, è£å†³ç»“æœ=English Cocker Spaniel
å¿«æ…¢ä¸ä¸€è‡´: fast=Bombay, slow=Black Cat, è£å†³ç»“æœ=Siamese
å¿«æ…¢ä¸ä¸€è‡´: fast=Birman, slow=Ragdoll, è£å†³ç»“æœ=Ragdoll
å¿«æ…¢ä¸ä¸€è‡´: fast=Bombay, slow=American Shorthair, è£å†³ç»“æœ=Bombay
å¿«æ…¢ä¸ä¸€è‡´: fast=Pomeranian, slow=Leonberger, è£å†³ç»“æœ=Samoyed
å¿«æ…¢ä¸ä¸€è‡´: fast=Newfoundland, slow=English Cocker Spaniel, è£å†³ç»“æœ=Newfoundland
å¿«æ…¢ä¸ä¸€è‡´: fast=Bombay, slow=Domestic Shorthair, è£å†³ç»“æœ=Egyptian Mau
å¿«æ…¢ä¸ä¸€è‡´: fast=Shiba Inu, slow=Wheaten Terrier, è£å†³ç»“æœ=Wheaten Terrier
âœ… æ­£ç¡®é¢„æµ‹æ€»æ•°: 360
  - å…¶ä¸­ä»…å¿«æ€è€ƒæ­£ç¡®: 263
  - å…¶ä¸­æ…¢æ€è€ƒè§¦å‘ä¸”æ­£ç¡®: 97
âŒ é”™è¯¯é¢„æµ‹æ€»æ•°: 39
ğŸ“Š æ…¢æ€è€ƒè§¦å‘æ•°é‡: 132
[fast_slow_classify] æ€»ä½“å‡†ç¡®ç‡: 0.9023 (360/399)
[fast_slow_classify] å¿«æ€è€ƒå‡†ç¡®ç‡: 0.9850
[fast_slow_classify] æ…¢æ€è€ƒè§¦å‘æ¯”ä¾‹: 0.3308
[fast_slow_classify] æ…¢æ€è€ƒå‡†ç¡®ç‡: 0.7348
åˆ†ç±»ç»“æœå·²ä¿å­˜åˆ°: ./experiments/pet37/classify/classification_results.json
å½“å‰æ—¶é—´ä¸ºï¼š 2025-11-01 10:34:32
æ€»è€—æ—¶: 00:07:55

/home/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/data/oldhome/hdl/miniconda3/envs/finer_dynamic/lib/python3.9/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Using a slow image processor as `use_fast` is unset and a slow processor was saved with this model. `use_fast=True` will be the default behavior in v4.48, even if the model was saved with a slow processor. This will result in minor differences in outputs. You'll still be able to use a slow processor with `use_fast=False`.
Namespace(mode='build_knowledge_base', config_file_env='./configs/env_machine.yml', config_file_expt='./configs/expts/pet37_all.yml', num_per_category='4', knowledge_base_dir='./experiments/pet37/knowledge_base', query_image=None, test_data_dir=None, results_out='./results.json', use_slow_thinking=None, confidence_threshold=0.8, similarity_threshold=0.7, enable_mllm_intermediate_judge=False, infer_dir=None, classify_dir=None)
{'setup': 'ours', 'experiment': 5.0, 'dataset_name': 'pet', 'num_classes': 37, 'num_base': 19, 'num_novel': 18, 'seed': 1, 'batch_size': 32, 'clustering_method': 'multi_clip_voting', 'model_size': 'ViT-B/16', 'model_size_vqa': 'FlanT5-XXL', 'model_size_mllm': 'Qwen2.5-VL-7B', 'model_type_llm': 'gpt-3.5-turbo', 'image_size': 224, 'verbose': False, 'host': 'xiao', 'num_workers': 16, 'device': 'cuda', 'device_count': '1', 'device_id': '0', 'data_dir': './datasets/pet_37', 'expt_dir': './experiments/pet37', 'expt_dir_describe': './experiments/pet37/describe', 'path_vqa_questions': './experiments/pet37/describe/pet_vqa_questions_ours', 'path_vqa_answers': './experiments/pet37/describe/pet_attributes_pairs', 'path_llm_prompts': './experiments/pet37/describe/pet_llm_prompts', 'path_identify_answers': './experiments/pet37/identify', 'expt_dir_guess': './experiments/pet37/guess', 'path_llm_replies_raw': './experiments/pet37/guess/pet_llm_replies_raw', 'path_llm_replies_jsoned': './experiments/pet37/guess/pet_llm_replies_jsoned', 'path_llm_gussed_names': './experiments/pet37/guess/pet_llm_gussed_names', 'expt_dir_gallery': './experiments/pet37/gallery', 'path_references': './experiments/pet37/gallery/pet_image_references', 'path_regions': './experiments/pet37/gallery/pet_image_regions', 'path_descriptions': './experiments/pet37/gallery/pet_image_descriptions_attn', 'expt_dir_grouping': './experiments/pet37/grouping'}
åˆå§‹åŒ–çŸ¥è¯†åº“æ„å»ºå™¨...
ğŸš€ èåˆæ–¹æ³•ä¸º 'weighted'ï¼Œè·³è¿‡BLIPæ¨¡å‹åŠ è½½ä»¥èŠ‚çœæ˜¾å­˜
è·å–MLLMæ¨¡å‹å®ä¾‹ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰...
ğŸš€ åˆå§‹åŒ–MLLMæ¨¡å‹: Qwen2.5-VL-7B on cuda
ğŸ“Š å½“å‰æ˜¾å­˜: 0.56GB / 79.25GB
Loading checkpoint shards:   0%|          | 0/5 [00:00<?, ?it/s]Loading checkpoint shards:  20%|â–ˆâ–ˆ        | 1/5 [00:01<00:07,  1.87s/it]Loading checkpoint shards:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 2/5 [00:04<00:06,  2.03s/it]Loading checkpoint shards:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 3/5 [00:06<00:04,  2.08s/it]Loading checkpoint shards:  80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 4/5 [00:08<00:02,  2.10s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5/5 [00:08<00:00,  1.60s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5/5 [00:08<00:00,  1.80s/it]
local_model_path: ./models/Qwen/Qwen2.5-VL-7B-Instruct
âœ… MLLMæ¨¡å‹åˆå§‹åŒ–å®Œæˆ
ğŸ“Š åŠ è½½åæ˜¾å­˜: 31.59GB / 79.25GB
åˆå§‹åŒ–å¿«æ€è€ƒæ¨¡å—...
æœªæ‰¾åˆ°å†å²ç»Ÿè®¡é‡æ–‡ä»¶ï¼Œå°†ä»å¤´å¼€å§‹
åˆå§‹åŒ–æ…¢æ€è€ƒæ¨¡å—...
å¿«æ…¢æ€è€ƒç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ!
Pet37 subcat_to_sample: {'German Shorthaired': ['./datasets/pet_37/images_discovery_all_4/014.German_Shorthaired/014.German_Shorthaired_122.jpg', './datasets/pet_37/images_discovery_all_4/014.German_Shorthaired/014.German_Shorthaired_175.jpg', './datasets/pet_37/images_discovery_all_4/014.German_Shorthaired/014.German_Shorthaired_104.jpg', './datasets/pet_37/images_discovery_all_4/014.German_Shorthaired/014.German_Shorthaired_155.jpg'], 'Beagle': ['./datasets/pet_37/images_discovery_all_4/004.Beagle/004.Beagle_175.jpg', './datasets/pet_37/images_discovery_all_4/004.Beagle/004.Beagle_157.jpg', './datasets/pet_37/images_discovery_all_4/004.Beagle/004.Beagle_164.jpg', './datasets/pet_37/images_discovery_all_4/004.Beagle/004.Beagle_140.jpg'], 'Staffordshire Bull Terrier': ['./datasets/pet_37/images_discovery_all_4/034.Staffordshire_Bull_Terrier/034.Staffordshire_Bull_Terrier_165.jpg', './datasets/pet_37/images_discovery_all_4/034.Staffordshire_Bull_Terrier/034.Staffordshire_Bull_Terrier_181.jpg', './datasets/pet_37/images_discovery_all_4/034.Staffordshire_Bull_Terrier/034.Staffordshire_Bull_Terrier_179.jpg', './datasets/pet_37/images_discovery_all_4/034.Staffordshire_Bull_Terrier/034.Staffordshire_Bull_Terrier_152.jpg'], 'Keeshond': ['./datasets/pet_37/images_discovery_all_4/018.Keeshond/018.Keeshond_117.jpg', './datasets/pet_37/images_discovery_all_4/018.Keeshond/018.Keeshond_128.jpg', './datasets/pet_37/images_discovery_all_4/018.Keeshond/018.Keeshond_104.jpg', './datasets/pet_37/images_discovery_all_4/018.Keeshond/018.Keeshond_142.jpg'], 'Saint Bernard': ['./datasets/pet_37/images_discovery_all_4/028.Saint_Bernard/028.Saint_Bernard_178.jpg', './datasets/pet_37/images_discovery_all_4/028.Saint_Bernard/028.Saint_Bernard_169.jpg', './datasets/pet_37/images_discovery_all_4/028.Saint_Bernard/028.Saint_Bernard_156.jpg', './datasets/pet_37/images_discovery_all_4/028.Saint_Bernard/028.Saint_Bernard_170.jpg'], 'Ragdoll': ['./datasets/pet_37/images_discovery_all_4/026.Ragdoll/026.Ragdoll_143.jpg', './datasets/pet_37/images_discovery_all_4/026.Ragdoll/026.Ragdoll_134.jpg', './datasets/pet_37/images_discovery_all_4/026.Ragdoll/026.Ragdoll_153.jpg', './datasets/pet_37/images_discovery_all_4/026.Ragdoll/026.Ragdoll_172.jpg'], 'Havanese': ['./datasets/pet_37/images_discovery_all_4/016.Havanese/016.Havanese_139.jpg', './datasets/pet_37/images_discovery_all_4/016.Havanese/016.Havanese_175.jpg', './datasets/pet_37/images_discovery_all_4/016.Havanese/016.Havanese_135.jpg', './datasets/pet_37/images_discovery_all_4/016.Havanese/016.Havanese_133.jpg'], 'Pug': ['./datasets/pet_37/images_discovery_all_4/025.Pug/025.Pug_165.jpg', './datasets/pet_37/images_discovery_all_4/025.Pug/025.Pug_117.jpg', './datasets/pet_37/images_discovery_all_4/025.Pug/025.Pug_13.jpg', './datasets/pet_37/images_discovery_all_4/025.Pug/025.Pug_105.jpg'], 'Great Pyrenees': ['./datasets/pet_37/images_discovery_all_4/015.Great_Pyrenees/015.Great_Pyrenees_106.jpg', './datasets/pet_37/images_discovery_all_4/015.Great_Pyrenees/015.Great_Pyrenees_18.jpg', './datasets/pet_37/images_discovery_all_4/015.Great_Pyrenees/015.Great_Pyrenees_134.jpg', './datasets/pet_37/images_discovery_all_4/015.Great_Pyrenees/015.Great_Pyrenees_103.jpg'], 'English Cocker Spaniel': ['./datasets/pet_37/images_discovery_all_4/012.English_Cocker_Spaniel/012.English_Cocker_Spaniel_165.jpg', './datasets/pet_37/images_discovery_all_4/012.English_Cocker_Spaniel/012.English_Cocker_Spaniel_101.jpg', './datasets/pet_37/images_discovery_all_4/012.English_Cocker_Spaniel/012.English_Cocker_Spaniel_11.jpg', './datasets/pet_37/images_discovery_all_4/012.English_Cocker_Spaniel/012.English_Cocker_Spaniel_140.jpg'], 'Miniature Pinscher': ['./datasets/pet_37/images_discovery_all_4/021.Miniature_Pinscher/021.Miniature_Pinscher_121.jpg', './datasets/pet_37/images_discovery_all_4/021.Miniature_Pinscher/021.Miniature_Pinscher_160.jpg', './datasets/pet_37/images_discovery_all_4/021.Miniature_Pinscher/021.Miniature_Pinscher_106.jpg', './datasets/pet_37/images_discovery_all_4/021.Miniature_Pinscher/021.Miniature_Pinscher_110.jpg'], 'Japanese Chin': ['./datasets/pet_37/images_discovery_all_4/017.Japanese_Chin/017.Japanese_Chin_17.jpg', './datasets/pet_37/images_discovery_all_4/017.Japanese_Chin/017.Japanese_Chin_171.jpg', './datasets/pet_37/images_discovery_all_4/017.Japanese_Chin/017.Japanese_Chin_127.jpg', './datasets/pet_37/images_discovery_all_4/017.Japanese_Chin/017.Japanese_Chin_150.jpg'], 'Scottish Terrier': ['./datasets/pet_37/images_discovery_all_4/030.Scottish_Terrier/030.Scottish_Terrier_148.jpg', './datasets/pet_37/images_discovery_all_4/030.Scottish_Terrier/030.Scottish_Terrier_173.jpg', './datasets/pet_37/images_discovery_all_4/030.Scottish_Terrier/030.Scottish_Terrier_176.jpg', './datasets/pet_37/images_discovery_all_4/030.Scottish_Terrier/030.Scottish_Terrier_179.jpg'], 'Newfoundland': ['./datasets/pet_37/images_discovery_all_4/022.Newfoundland/022.Newfoundland_118.jpg', './datasets/pet_37/images_discovery_all_4/022.Newfoundland/022.Newfoundland_134.jpg', './datasets/pet_37/images_discovery_all_4/022.Newfoundland/022.Newfoundland_140.jpg', './datasets/pet_37/images_discovery_all_4/022.Newfoundland/022.Newfoundland_16.jpg'], 'Shiba Inu': ['./datasets/pet_37/images_discovery_all_4/031.Shiba_Inu/031.Shiba_Inu_137.jpg', './datasets/pet_37/images_discovery_all_4/031.Shiba_Inu/031.Shiba_Inu_173.jpg', './datasets/pet_37/images_discovery_all_4/031.Shiba_Inu/031.Shiba_Inu_108.jpg', './datasets/pet_37/images_discovery_all_4/031.Shiba_Inu/031.Shiba_Inu_157.jpg'], 'Basset Hound': ['./datasets/pet_37/images_discovery_all_4/003.Basset_Hound/003.Basset_Hound_153.jpg', './datasets/pet_37/images_discovery_all_4/003.Basset_Hound/003.Basset_Hound_135.jpg', './datasets/pet_37/images_discovery_all_4/003.Basset_Hound/003.Basset_Hound_155.jpg', './datasets/pet_37/images_discovery_all_4/003.Basset_Hound/003.Basset_Hound_129.jpg'], 'Chihuahua': ['./datasets/pet_37/images_discovery_all_4/010.Chihuahua/010.Chihuahua_179.jpg', './datasets/pet_37/images_discovery_all_4/010.Chihuahua/010.Chihuahua_132.jpg', './datasets/pet_37/images_discovery_all_4/010.Chihuahua/010.Chihuahua_158.jpg', './datasets/pet_37/images_discovery_all_4/010.Chihuahua/010.Chihuahua_116.jpg'], 'Samoyed': ['./datasets/pet_37/images_discovery_all_4/029.Samoyed/029.Samoyed_139.jpg', './datasets/pet_37/images_discovery_all_4/029.Samoyed/029.Samoyed_11.jpg', './datasets/pet_37/images_discovery_all_4/029.Samoyed/029.Samoyed_101.jpg', './datasets/pet_37/images_discovery_all_4/029.Samoyed/029.Samoyed_114.jpg'], 'Sphynx': ['./datasets/pet_37/images_discovery_all_4/033.Sphynx/033.Sphynx_166.jpg', './datasets/pet_37/images_discovery_all_4/033.Sphynx/033.Sphynx_110.jpg', './datasets/pet_37/images_discovery_all_4/033.Sphynx/033.Sphynx_143.jpg', './datasets/pet_37/images_discovery_all_4/033.Sphynx/033.Sphynx_160.jpg'], 'Leonberger': ['./datasets/pet_37/images_discovery_all_4/019.Leonberger/019.Leonberger_138.jpg', './datasets/pet_37/images_discovery_all_4/019.Leonberger/019.Leonberger_136.jpg', './datasets/pet_37/images_discovery_all_4/019.Leonberger/019.Leonberger_173.jpg', './datasets/pet_37/images_discovery_all_4/019.Leonberger/019.Leonberger_181.jpg'], 'Birman': ['./datasets/pet_37/images_discovery_all_4/006.Birman/006.Birman_133.jpg', './datasets/pet_37/images_discovery_all_4/006.Birman/006.Birman_156.jpg', './datasets/pet_37/images_discovery_all_4/006.Birman/006.Birman_179.jpg', './datasets/pet_37/images_discovery_all_4/006.Birman/006.Birman_134.jpg'], 'Bombay': ['./datasets/pet_37/images_discovery_all_4/007.Bombay/007.Bombay_10.jpg', './datasets/pet_37/images_discovery_all_4/007.Bombay/007.Bombay_151.jpg', './datasets/pet_37/images_discovery_all_4/007.Bombay/007.Bombay_148.jpg', './datasets/pet_37/images_discovery_all_4/007.Bombay/007.Bombay_166.jpg'], 'Maine Coon': ['./datasets/pet_37/images_discovery_all_4/020.Maine_Coon/020.Maine_Coon_171.jpg', './datasets/pet_37/images_discovery_all_4/020.Maine_Coon/020.Maine_Coon_104.jpg', './datasets/pet_37/images_discovery_all_4/020.Maine_Coon/020.Maine_Coon_141.jpg', './datasets/pet_37/images_discovery_all_4/020.Maine_Coon/020.Maine_Coon_176.jpg'], 'Siamese': ['./datasets/pet_37/images_discovery_all_4/032.Siamese/032.Siamese_157.jpg', './datasets/pet_37/images_discovery_all_4/032.Siamese/032.Siamese_119.jpg', './datasets/pet_37/images_discovery_all_4/032.Siamese/032.Siamese_143.jpg', './datasets/pet_37/images_discovery_all_4/032.Siamese/032.Siamese_164.jpg'], 'Bengal': ['./datasets/pet_37/images_discovery_all_4/005.Bengal/005.Bengal_122.jpg', './datasets/pet_37/images_discovery_all_4/005.Bengal/005.Bengal_190.jpg', './datasets/pet_37/images_discovery_all_4/005.Bengal/005.Bengal_119.jpg', './datasets/pet_37/images_discovery_all_4/005.Bengal/005.Bengal_191.jpg'], 'Abyssinian': ['./datasets/pet_37/images_discovery_all_4/000.Abyssinian/000.Abyssinian_106.jpg', './datasets/pet_37/images_discovery_all_4/000.Abyssinian/000.Abyssinian_136.jpg', './datasets/pet_37/images_discovery_all_4/000.Abyssinian/000.Abyssinian_148.jpg', './datasets/pet_37/images_discovery_all_4/000.Abyssinian/000.Abyssinian_146.jpg'], 'Yorkshire Terrier': ['./datasets/pet_37/images_discovery_all_4/036.Yorkshire_Terrier/036.Yorkshire_Terrier_102.jpg', './datasets/pet_37/images_discovery_all_4/036.Yorkshire_Terrier/036.Yorkshire_Terrier_14.jpg', './datasets/pet_37/images_discovery_all_4/036.Yorkshire_Terrier/036.Yorkshire_Terrier_183.jpg', './datasets/pet_37/images_discovery_all_4/036.Yorkshire_Terrier/036.Yorkshire_Terrier_161.jpg'], 'Russian Blue': ['./datasets/pet_37/images_discovery_all_4/027.Russian_Blue/027.Russian_Blue_100.jpg', './datasets/pet_37/images_discovery_all_4/027.Russian_Blue/027.Russian_Blue_151.jpg', './datasets/pet_37/images_discovery_all_4/027.Russian_Blue/027.Russian_Blue_137.jpg', './datasets/pet_37/images_discovery_all_4/027.Russian_Blue/027.Russian_Blue_103.jpg'], 'Persian': ['./datasets/pet_37/images_discovery_all_4/023.Persian/023.Persian_102.jpg', './datasets/pet_37/images_discovery_all_4/023.Persian/023.Persian_181.jpg', './datasets/pet_37/images_discovery_all_4/023.Persian/023.Persian_104.jpg', './datasets/pet_37/images_discovery_all_4/023.Persian/023.Persian_176.jpg'], 'English Setter': ['./datasets/pet_37/images_discovery_all_4/013.English_Setter/013.English_Setter_181.jpg', './datasets/pet_37/images_discovery_all_4/013.English_Setter/013.English_Setter_183.jpg', './datasets/pet_37/images_discovery_all_4/013.English_Setter/013.English_Setter_143.jpg', './datasets/pet_37/images_discovery_all_4/013.English_Setter/013.English_Setter_129.jpg'], 'Boxer': ['./datasets/pet_37/images_discovery_all_4/008.Boxer/008.Boxer_189.jpg', './datasets/pet_37/images_discovery_all_4/008.Boxer/008.Boxer_174.jpg', './datasets/pet_37/images_discovery_all_4/008.Boxer/008.Boxer_183.jpg', './datasets/pet_37/images_discovery_all_4/008.Boxer/008.Boxer_101.jpg'], 'Pomeranian': ['./datasets/pet_37/images_discovery_all_4/024.Pomeranian/024.Pomeranian_17.jpg', './datasets/pet_37/images_discovery_all_4/024.Pomeranian/024.Pomeranian_178.jpg', './datasets/pet_37/images_discovery_all_4/024.Pomeranian/024.Pomeranian_100.jpg', './datasets/pet_37/images_discovery_all_4/024.Pomeranian/024.Pomeranian_130.jpg'], 'American Pit Bull Terrier': ['./datasets/pet_37/images_discovery_all_4/002.American_Pit_Bull_Terrier/002.American_Pit_Bull_Terrier_18.jpg', './datasets/pet_37/images_discovery_all_4/002.American_Pit_Bull_Terrier/002.American_Pit_Bull_Terrier_142.jpg', './datasets/pet_37/images_discovery_all_4/002.American_Pit_Bull_Terrier/002.American_Pit_Bull_Terrier_108.jpg', './datasets/pet_37/images_discovery_all_4/002.American_Pit_Bull_Terrier/002.American_Pit_Bull_Terrier_136.jpg'], 'Wheaten Terrier': ['./datasets/pet_37/images_discovery_all_4/035.Wheaten_Terrier/035.Wheaten_Terrier_182.jpg', './datasets/pet_37/images_discovery_all_4/035.Wheaten_Terrier/035.Wheaten_Terrier_13.jpg', './datasets/pet_37/images_discovery_all_4/035.Wheaten_Terrier/035.Wheaten_Terrier_140.jpg', './datasets/pet_37/images_discovery_all_4/035.Wheaten_Terrier/035.Wheaten_Terrier_186.jpg'], 'British Shorthair': ['./datasets/pet_37/images_discovery_all_4/009.British_Shorthair/009.British_Shorthair_166.jpg', './datasets/pet_37/images_discovery_all_4/009.British_Shorthair/009.British_Shorthair_145.jpg', './datasets/pet_37/images_discovery_all_4/009.British_Shorthair/009.British_Shorthair_108.jpg', './datasets/pet_37/images_discovery_all_4/009.British_Shorthair/009.British_Shorthair_100.jpg'], 'Egyptian Mau': ['./datasets/pet_37/images_discovery_all_4/011.Egyptian_Mau/011.Egyptian_Mau_13.jpg', './datasets/pet_37/images_discovery_all_4/011.Egyptian_Mau/011.Egyptian_Mau_165.jpg', './datasets/pet_37/images_discovery_all_4/011.Egyptian_Mau/011.Egyptian_Mau_138.jpg', './datasets/pet_37/images_discovery_all_4/011.Egyptian_Mau/011.Egyptian_Mau_14.jpg'], 'American Bulldog': ['./datasets/pet_37/images_discovery_all_4/001.American_Bulldog/001.American_Bulldog_115.jpg', './datasets/pet_37/images_discovery_all_4/001.American_Bulldog/001.American_Bulldog_144.jpg', './datasets/pet_37/images_discovery_all_4/001.American_Bulldog/001.American_Bulldog_135.jpg', './datasets/pet_37/images_discovery_all_4/001.American_Bulldog/001.American_Bulldog_16.jpg']}
æ„å»ºçŸ¥è¯†åº“ï¼ŒåŒ…å« 37 ä¸ªç±»åˆ«, dog datasets:37
ä» ./experiments/pet37/knowledge_base åŠ è½½çŸ¥è¯†åº“...
ç±»åˆ«å›¾åƒè·¯å¾„å·²ä» ./experiments/pet37/knowledge_base/category_image_paths.json åŠ è½½
åŠ è½½äº† 37 ä¸ªç±»åˆ«çš„å›¾åƒè·¯å¾„
çŸ¥è¯†åº“å·²ä» ./experiments/pet37/knowledge_base åŠ è½½
çŸ¥è¯†åº“åŠ è½½å®Œæˆ!
æ„å»ºçŸ¥è¯†åº“...
è®­ç»ƒæ ·æœ¬åŒ…å« 37 ä¸ªç±»åˆ«
å¼€å§‹æ„å»ºçŸ¥è¯†åº“...
æ„å»ºå›¾åƒçŸ¥è¯†åº“...
  0%|          | 0/37 [00:00<?, ?it/s]  3%|â–         | 1/37 [00:00<00:08,  4.28it/s] 11%|â–ˆ         | 4/37 [00:00<00:02, 13.25it/s] 19%|â–ˆâ–‰        | 7/37 [00:00<00:01, 17.74it/s] 27%|â–ˆâ–ˆâ–‹       | 10/37 [00:00<00:01, 20.63it/s] 35%|â–ˆâ–ˆâ–ˆâ–Œ      | 13/37 [00:00<00:01, 22.73it/s]
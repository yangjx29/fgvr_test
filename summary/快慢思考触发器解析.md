# å¿«æ…¢æ€è€ƒè§¦å‘å™¨æœºåˆ¶è¯¦è§£

## ğŸ“– æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•äº†å¿«æ…¢æ€è€ƒç³»ç»Ÿä¸­**å¿«æ€è€ƒå¦‚ä½•åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›å…¥æ…¢æ€è€ƒ**çš„å®Œæ•´é€»è¾‘ï¼ŒåŒ…æ‹¬ï¼š
- ğŸ” **è§¦å‘å™¨åˆ¤æ–­æµç¨‹**ï¼šå¤šå±‚çº§è§„åˆ™åˆ¤æ–­æœºåˆ¶
- ğŸ“ **æ•°å­¦å…¬å¼è¯¦è§£**ï¼šæ‰€æœ‰è®¡ç®—å…¬å¼çš„æ¨å¯¼å’Œå®ç°
- ğŸ§® **LCBç®—æ³•åŸç†**ï¼šåŸºäºUCBç†è®ºçš„åŠ¨æ€é˜ˆå€¼è®¡ç®—
- ğŸ¤– **MLLMå¢å¼ºåˆ¤æ–­**ï¼šå¤šæ¨¡æ€å¤§æ¨¡å‹çš„æ™ºèƒ½å†³ç­–å±‚
- ğŸ“Š **å®ç°ç»†èŠ‚ç´¢å¼•**ï¼šç²¾ç¡®åˆ°ä»£ç è¡Œå·çš„å®ç°ä½ç½®

**æ ¸å¿ƒé—®é¢˜**ï¼šå¿«æ€è€ƒåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘æ…¢æ€è€ƒï¼Ÿ

**ç­”æ¡ˆ**ï¼šé€šè¿‡**å››å±‚çº§è§„åˆ™åˆ¤æ–­ + LCBåŠ¨æ€è¯„ä¼°**ï¼Œæˆ–è€…ä½¿ç”¨**MLLMæ™ºèƒ½åˆ¤æ–­**æ¥å†³å®šã€‚

## ğŸ”„ å¿«æ…¢æ€è€ƒè°ƒåº¦é€»è¾‘å…¨è§£æ

### 1. åŸæœ‰å¿«æ…¢æ€è€ƒè°ƒåº¦é€»è¾‘ï¼ˆåŸºäºè§„åˆ™çš„å¤šå±‚çº§è§¦å‘ï¼‰

#### 1.1 è§¦å‘æœºåˆ¶æ€»ä½“æµç¨‹

```
å¿«æ€è€ƒæ‰§è¡Œ â†’ å››å±‚çº§è§„åˆ™åˆ¤æ–­ â†’ LCBåŠ¨æ€è¯„ä¼° â†’ æ˜¯å¦è§¦å‘æ…¢æ€è€ƒ
```

**æ ¸å¿ƒå®ç°ä½ç½®ï¼š** `fast_thinking.py` ç¬¬289-341è¡Œ `trigger_lcb()` æ–¹æ³•

#### 1.2 å¿«æ€è€ƒè¿›å…¥æ…¢æ€è€ƒçš„å®Œæ•´åˆ¤æ–­æµç¨‹

```mermaid
graph TD
    A[å¿«æ€è€ƒå®Œæˆ] --> B{å±‚çº§1: é«˜ç½®ä¿¡åº¦?}
    B -->|æ˜¯: fused_confâ‰¥0.6 ä¸” marginâ‰¥0.12| C[ç›´æ¥è¿”å›ç»“æœ<br/>æ— éœ€æ…¢æ€è€ƒ]
    B -->|å¦| D{å±‚çº§2: æ¨¡æ€ä¸€è‡´?}
    D -->|æ˜¯: å›¾æ–‡ç›¸ä¼¼ ä¸” åŒæ¨¡æ€confâ‰¥0.5| C
    D -->|å¦| E{å±‚çº§3: Top-Ké‡å ?}
    E -->|æ˜¯: æœ‰é‡å  ä¸” fused_confâ‰¥0.54| C
    E -->|å¦| F{å±‚çº§4: LCBâ‰¥0.7?}
    F -->|æ˜¯: LCBè¶³å¤Ÿé«˜| C
    F -->|å¦: LCB<0.7| G[è§¦å‘æ…¢æ€è€ƒ]
    
    style C fill:#90EE90
    style G fill:#FFB6C1
```

**åˆ¤æ–­é€»è¾‘è¯´æ˜**ï¼š
1. **å±‚çº§1-3**ï¼šåŸºäºå¿«æ€è€ƒç»“æœçš„ç½®ä¿¡åº¦ã€æ¨¡æ€ä¸€è‡´æ€§å’ŒTop-Ké‡å è¿›è¡Œå¿«é€Ÿåˆ¤æ–­
2. **å±‚çº§4**ï¼šä½¿ç”¨LCBç®—æ³•ç»¼åˆå†å²è¡¨ç°å’Œå½“å‰ä¸ç¡®å®šæ€§è¿›è¡ŒåŠ¨æ€è¯„ä¼°
3. **åªè¦ä»»ä¸€å±‚çº§æ»¡è¶³æ¡ä»¶**ï¼šç›´æ¥è¿”å›ç»“æœï¼Œæ— éœ€æ…¢æ€è€ƒ
4. **æ‰€æœ‰å±‚çº§éƒ½ä¸æ»¡è¶³**ï¼šè§¦å‘æ…¢æ€è€ƒè¿›è¡Œæ·±åº¦åˆ†æ

#### 1.2 å››å±‚çº§åˆ¤æ–­æœºåˆ¶è¯¦è§£

| å±‚çº§ | åˆ¤æ–­æ¡ä»¶ | ä»£ç ä½ç½® | é˜ˆå€¼è®¾ç½® | åˆ¤æ–­é€»è¾‘ |
|------|----------|----------|----------|----------|
| **å±‚çº§1** | é«˜ç½®ä¿¡åº¦å¿«é€Ÿè¿”å› | `fast_thinking.py:309-310` | `fused_conf_threshold=0.6`<br>`fused_margin_threshold=0.12` | èåˆç½®ä¿¡åº¦â‰¥0.6 **ä¸”** è¾¹é™…å·®å¼‚â‰¥0.12 |
| **å±‚çº§2** | æ¨¡æ€ä¸€è‡´æ€§æ£€æŸ¥ | `fast_thinking.py:313-314` | `similarity_threshold=0.7`<br>`per_modality_conf_threshold=0.5` | å›¾æ–‡ç±»åˆ«ç›¸ä¼¼â‰¥0.7 **ä¸”** åŒæ¨¡æ€ç½®ä¿¡åº¦â‰¥0.5 |
| **å±‚çº§3** | Top-Ké‡å éªŒè¯ | `fast_thinking.py:317-318` | `fused_conf_threshold * 0.9=0.54` | Top-Kæœ‰é‡å  **ä¸”** èåˆç½®ä¿¡åº¦â‰¥0.54 |
| **å±‚çº§4** | LCBåŠ¨æ€é˜ˆå€¼ | `fast_thinking.py:334-337` | `lcb_threshold=0.7` | åŸºäºUCBç†è®ºçš„Lower Confidence Boundâ‰¥0.7 |

#### 1.3 åŸæœ‰è§¦å‘æœºåˆ¶ç‰¹ç‚¹

**ä¼˜åŠ¿ï¼š**
- âœ… **å¤šå±‚ä¿æŠ¤**ï¼š4ä¸ªå±‚çº§é€çº§ç­›é€‰ï¼Œå‡å°‘è¯¯åˆ¤
- âœ… **å‚æ•°åŒ–æ§åˆ¶**ï¼šæ‰€æœ‰é˜ˆå€¼å¯é…ç½®ï¼Œä¾¿äºè°ƒä¼˜
- âœ… **ç†è®ºæ”¯æ’‘**ï¼šLCBåŸºäºUCBç†è®ºï¼Œæœ‰æ•°å­¦åŸºç¡€
- âœ… **è®¡ç®—é«˜æ•ˆ**ï¼šçº¯æ•°å€¼è®¡ç®—ï¼Œæ— é¢å¤–æ¨¡å‹è°ƒç”¨

**å±€é™æ€§ï¼š**
- âŒ **ç¼ºä¹è¯­ä¹‰ç†è§£**ï¼šä»…åŸºäºæ•°å€¼ç‰¹å¾ï¼Œæ— æ³•ç†è§£å›¾åƒå†…å®¹
- âŒ **å›ºå®šé˜ˆå€¼**ï¼šé¢„è®¾å‚æ•°å¯èƒ½ä¸é€‚ç”¨æ‰€æœ‰åœºæ™¯
- âŒ **æ¨¡æ€å‰²è£‚**ï¼šåˆ†åˆ«å¤„ç†å›¾æ–‡ä¿¡æ¯ï¼Œç¼ºä¹æ·±åº¦èåˆåˆ¤æ–­
- âŒ **è¾¹ç•Œcaseæ•æ„Ÿ**ï¼šåœ¨é˜ˆå€¼è¾¹ç•Œå®¹æ˜“äº§ç”Ÿä¸ç¨³å®šåˆ¤æ–­

#### 1.4 LCBç®—æ³•æ ¸å¿ƒè¯¦è§£ï¼ˆç¬¬343-395è¡Œï¼‰

**LCB (Lower Confidence Bound)** æ˜¯åŸºäºUCBç†è®ºçš„åŠ¨æ€ç½®ä¿¡åº¦è¯„ä¼°ç®—æ³•ï¼Œç»¼åˆè€ƒè™‘å†å²è¡¨ç°å’Œå½“å‰ä¸ç¡®å®šæ€§ã€‚

##### 1.4.1 LCBè®¡ç®—å…¬å¼

```
LCB = pÌ‚ - confidence_term - Î± Ã— H
```

å…¶ä¸­ï¼š
- **pÌ‚**: Betaå…ˆéªŒå¹³æ»‘åçš„å†å²å‡†ç¡®ç‡ä¼°è®¡
- **confidence_term**: ç»Ÿè®¡ç½®ä¿¡åŒºé—´é¡¹ï¼ˆåŸºäºUCBç†è®ºï¼‰
- **Î±**: ç†µæƒé‡ç³»æ•°ï¼ˆé»˜è®¤0.5ï¼‰
- **H**: å½’ä¸€åŒ–ç†µï¼ˆåæ˜ å½“å‰é¢„æµ‹çš„ä¸ç¡®å®šæ€§ï¼‰

##### 1.4.2 å„é¡¹è®¡ç®—è¯¦è§£

**1) Betaå…ˆéªŒå¹³æ»‘ï¼ˆè§£å†³å†·å¯åŠ¨é—®é¢˜ï¼‰**
```python
n = n_raw + prior_strength          # å†å²é¢„æµ‹æ¬¡æ•° + å…ˆéªŒå¼ºåº¦(2.0)
m = m_raw + prior_p Ã— prior_strength # å†å²æ­£ç¡®æ¬¡æ•° + å…ˆéªŒæ­£ç¡®ç‡(0.6) Ã— å…ˆéªŒå¼ºåº¦
pÌ‚ = m / (n + Îµ)                     # å¹³æ»‘åçš„å‡†ç¡®ç‡ä¼°è®¡
```

**2) ç½®ä¿¡åº¦åˆ†å¸ƒç†µï¼ˆåæ˜ æ¨¡å‹çŠ¹è±«ç¨‹åº¦ï¼‰**
```python
# è¾“å…¥: confidence_scores = [img_confidence, text_confidence, fused_top1_prob]
probs = confidence_scores / sum(confidence_scores)  # å½’ä¸€åŒ–ä¸ºæ¦‚ç‡åˆ†å¸ƒ
H = -Î£(p_i Ã— log(p_i)) / log(len(probs))          # å½’ä¸€åŒ–ç†µ âˆˆ [0,1]
```

**3) ç½®ä¿¡åŒºé—´é¡¹ï¼ˆåŸºäºUCBç†è®ºï¼‰**
```python
if n_raw > 0:
    confidence_term = Î· Ã— sqrt(log(total_predictions) / (2Ã—n + 1))
else:  # å†·å¯åŠ¨æƒ…å†µ
    confidence_term = Î· Ã— sqrt(log(total_predictions))
```

å…¶ä¸­ Î· (lcb_eta) é»˜è®¤ä¸º1.0

##### 1.4.3 LCBåˆ¤æ–­é€»è¾‘

```python
if LCB â‰¥ 0.7:
    return False  # æ— éœ€æ…¢æ€è€ƒï¼Œç›´æ¥è¿”å›ç»“æœ
else:
    return True   # è§¦å‘æ…¢æ€è€ƒ
```

**ç‰©ç†æ„ä¹‰**ï¼š
- **LCBé«˜ï¼ˆâ‰¥0.7ï¼‰**ï¼šè¯¥ç±»åˆ«å†å²è¡¨ç°å¥½ä¸”å½“å‰ç¡®å®šæ€§é«˜ â†’ å¯ä¿¡ï¼Œæ— éœ€æ…¢æ€è€ƒ
- **LCBä½ï¼ˆ<0.7ï¼‰**ï¼šå†å²è¡¨ç°å·®æˆ–å½“å‰ä¸ç¡®å®šæ€§é«˜ â†’ ä¸å¯ä¿¡ï¼Œéœ€è¦æ…¢æ€è€ƒ

**ä»£ç å®ç°**ï¼š`fast_thinking.py` ç¬¬343-383è¡Œ

### 2. æ–°å¢MLLMä¸­é—´åˆ¤æ–­ä¼˜åŒ–é€»è¾‘

#### 2.1 ä¸‰ç§è§¦å‘æ¨¡å¼æ¶æ„

**æ ¸å¿ƒå®ç°ä½ç½®ï¼š** `fast_slow_thinking_system.py` ç¬¬297-314è¡Œ `classify_single_image()` æ–¹æ³•

```python
if use_slow_thinking is not None:
    # æ¨¡å¼1: å¼ºåˆ¶æŒ‡å®šï¼ˆå®éªŒæ§åˆ¶ï¼‰
elif self.enable_mllm_intermediate_judge:
    # æ¨¡å¼2: MLLMä¸­é—´åˆ¤æ–­ï¼ˆæ–°å¢ä¼˜åŒ–ï¼‰
else:
    # æ¨¡å¼3: ä¼ ç»Ÿè§„åˆ™åˆ¤æ–­ï¼ˆåŸæœ‰é€»è¾‘ï¼‰
```

#### 2.2 MLLMä¸­é—´åˆ¤æ–­è¯¦ç»†æµç¨‹

| æ­¥éª¤ | åŠŸèƒ½ | ä»£ç ä½ç½® | æ ¸å¿ƒé€»è¾‘ |
|------|------|----------|----------|
| **è¾“å…¥å‡†å¤‡** | è·å–å¿«æ€è€ƒTop-Kç»“æœ | `fast_slow_thinking_system.py:182-193` | æå–èåˆæ’åºç»“æœ |
| **æç¤ºæ„é€ ** | æ„å»ºMLLMåˆ†ææç¤º | `fast_slow_thinking_system.py:194-208` | ç»“æ„åŒ–å€™é€‰ç±»åˆ«åˆ—è¡¨ |
| **æ¨¡å‹è°ƒç”¨** | MLLMè§†è§‰åˆ†æ | `fast_slow_thinking_system.py:210-213` | `text_image_response_multimodal()` |
| **å“åº”è§£æ** | æå–å†³ç­–å’Œç½®ä¿¡åº¦ | `fast_slow_thinking_system.py:220-265` | è§£æ"æœ‰ä¿¡å¿ƒ/æ²¡ä¿¡å¿ƒ" + æ•°å€¼ |
| **åŒé‡åˆ¤æ–­** | æ–‡æœ¬å†³ç­– + æ•°å€¼é˜ˆå€¼ | `fast_slow_thinking_system.py:256` | `decision_confident AND confidenceâ‰¥0.6` |

#### 2.3 MLLMåˆ¤æ–­æ ¸å¿ƒé€»è¾‘

**åŒé‡ç½®ä¿¡åº¦è¯„ä¼°æœºåˆ¶ï¼š**

```python
# æ¡ä»¶1: ä¸»è§‚æ–‡æœ¬å†³ç­–
decision_confident = 'æœ‰ä¿¡å¿ƒ' in mllm_response

# æ¡ä»¶2: å®¢è§‚æ•°å€¼ç½®ä¿¡åº¦  
confidence >= 0.6

# æœ€ç»ˆå†³ç­–: ä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³æ‰è·³è¿‡æ…¢æ€è€ƒ
need_slow_thinking = not (decision_confident and confidence >= 0.6)
```

**ä»£ç ä½ç½®ï¼š** `fast_slow_thinking_system.py` ç¬¬256è¡Œ

## ğŸ“Š åŸæœ‰ vs ä¼˜åŒ– å¯¹æ¯”åˆ†æè¡¨

### 3.1 è§¦å‘æœºåˆ¶å¯¹æ¯”

| ç»´åº¦ | åŸæœ‰è§„åˆ™è§¦å‘ | MLLMä¸­é—´åˆ¤æ–­ | æ”¹è¿›æ•ˆæœ |
|------|-------------|-------------|----------|
| **åˆ¤æ–­ä¾æ®** | æ•°å€¼é˜ˆå€¼ + ç»Ÿè®¡ç‰¹å¾ | è§†è§‰å†…å®¹ + è¯­ä¹‰ç†è§£ | âœ… ä»ç»Ÿè®¡åˆ°è¯­ä¹‰ |
| **é€‚åº”æ€§** | å›ºå®šå‚æ•°ï¼Œåœºæ™¯é€‚åº”å¼± | åŠ¨æ€åˆ¤æ–­ï¼Œåœºæ™¯è‡ªé€‚åº” | âœ… è‡ªé€‚åº”èƒ½åŠ›â†‘ |
| **å¯è§£é‡Šæ€§** | è§„åˆ™é€æ˜ï¼Œä½†ç¼ºä¹è¯­ä¹‰ | MLLMæä¾›æ¨ç†è¿‡ç¨‹ | âœ… è¯­ä¹‰å¯è§£é‡Šæ€§â†‘ |
| **è®¡ç®—å¼€é”€** | çº¯æ•°å€¼è®¡ç®—ï¼ˆ~1msï¼‰ | MLLMæ¨ç†ï¼ˆ~500msï¼‰ | âŒ è®¡ç®—å¼€é”€â†‘ |
| **å‡†ç¡®æ€§** | ä¾èµ–ç‰¹å¾å·¥ç¨‹ | åˆ©ç”¨æ¨¡å‹è§†è§‰èƒ½åŠ› | âœ… é¢„æœŸå‡†ç¡®æ€§â†‘ |
| **è¾¹ç•Œç¨³å®šæ€§** | é˜ˆå€¼è¾¹ç•Œæ•æ„Ÿ | æ¨¡å‹è¿ç»­åˆ¤æ–­ | âœ… è¾¹ç•Œç¨³å®šæ€§â†‘ |

### 3.2 å‚æ•°é…ç½®å¯¹æ¯”

| å‚æ•°ç±»å‹ | åŸæœ‰è§¦å‘æœºåˆ¶ | MLLMä¼˜åŒ–æœºåˆ¶ | è°ƒä¼˜éš¾åº¦ |
|---------|-------------|-------------|---------|
| **èåˆç½®ä¿¡åº¦é˜ˆå€¼** | `fused_conf_threshold=0.6` | - | éœ€è¦æ•°æ®é©±åŠ¨è°ƒä¼˜ |
| **è¾¹é™…å·®å¼‚é˜ˆå€¼** | `fused_margin_threshold=0.12` | - | éœ€è¦æ•°æ®é©±åŠ¨è°ƒä¼˜ |
| **æ¨¡æ€ç½®ä¿¡åº¦é˜ˆå€¼** | `per_modality_conf_threshold=0.5` | - | éœ€è¦æ•°æ®é©±åŠ¨è°ƒä¼˜ |
| **LCBé˜ˆå€¼** | `lcb_threshold=0.7` | - | éœ€è¦ç†è®º+å®éªŒè°ƒä¼˜ |
| **MLLMç½®ä¿¡åº¦é˜ˆå€¼** | - | `mllm_confidence_threshold=0.6` | ç›¸å¯¹å®¹æ˜“è°ƒä¼˜ |
| **å¼€å…³æ§åˆ¶** | - | `enable_mllm_intermediate_judge` | ä¸€é”®åˆ‡æ¢ |

### 3.3 æ€§èƒ½æŒ‡æ ‡é¢„æœŸå¯¹æ¯”

| æŒ‡æ ‡ | åŸæœ‰è§¦å‘ | MLLMä¼˜åŒ– | å˜åŒ–è¶‹åŠ¿ |
|------|---------|---------|---------|
| **æ…¢æ€è€ƒè§¦å‘ç‡** | åŸºçº¿å€¼ | é¢„æœŸé™ä½10-20% | â¬‡ï¸ æ›´ç²¾å‡†è§¦å‘ |
| **åˆ†ç±»å‡†ç¡®ç‡** | åŸºçº¿å€¼ | é¢„æœŸæå‡2-5% | â¬†ï¸ å‡å°‘è¯¯åˆ¤ |
| **å¹³å‡æ¨ç†æ—¶é—´** | åŸºçº¿å€¼ | å¢åŠ ~500ms | â¬†ï¸ MLLMåˆ¤æ–­å¼€é”€ |
| **è¾¹ç•Œcaseå¤„ç†** | ä¸ç¨³å®š | æ›´ç¨³å®š | â¬†ï¸ å‡å°‘æŠ–åŠ¨ |
| **å¤æ‚åœºæ™¯é€‚åº”** | è¾ƒå¼± | è¾ƒå¼º | â¬†ï¸ è¯­ä¹‰ç†è§£ä¼˜åŠ¿ |

## ğŸ”§ å®ç°æ¶æ„è¯¦è§£

### 4.1 ä»£ç è°ƒç”¨é“¾è·¯å›¾

```
discovering.py (å…¥å£)
â””â”€â”€ FastSlowThinkingSystem.classify_single_image()  [297-314è¡Œ]
    â”œâ”€â”€ å¼ºåˆ¶æ¨¡å¼: use_slow_thinking != None
    â”œâ”€â”€ MLLMæ¨¡å¼: self.mllm_intermediate_judge()     [154-218è¡Œ]
    â””â”€â”€ ä¼ ç»Ÿæ¨¡å¼: fast_result["need_slow_thinking"]
                   â””â”€â”€ FastThinking.trigger_lcb()    [289-341è¡Œ]
                       â””â”€â”€ calculate_lcb()           [343-395è¡Œ]
```

### 4.2 å…³é”®æ–‡ä»¶å’Œè¡Œå·ç´¢å¼•

| åŠŸèƒ½æ¨¡å— | æ–‡ä»¶ä½ç½® | å…³é”®æ–¹æ³• | è¡Œå·èŒƒå›´ |
|---------|----------|----------|----------|
| **MLLMè§¦å‘æ§åˆ¶** | `fast_slow_thinking_system.py` | `classify_single_image()` | 297-314 |
| **MLLMä¸­é—´åˆ¤æ–­** | `fast_slow_thinking_system.py` | `mllm_intermediate_judge()` | 154-218 |
| **MLLMå“åº”è§£æ** | `fast_slow_thinking_system.py` | `_parse_mllm_judge_response()` | 220-265 |
| **ä¼ ç»Ÿè§¦å‘æœºåˆ¶** | `fast_thinking.py` | `trigger_lcb()` | 289-341 |
| **LCBç®—æ³•å®ç°** | `fast_thinking.py` | `calculate_lcb()` | 343-395 |
| **å¿«æ€è€ƒä¸»æµç¨‹** | `fast_thinking.py` | `fast_thinking_pipeline()` | 469-471 |
| **å‚æ•°é…ç½®** | `discovering.py` | å‘½ä»¤è¡Œå‚æ•° | 374 |

### 4.3 æ§åˆ¶å¼€å…³ä½¿ç”¨æ–¹æ³•

**å¯ç”¨MLLMä¸­é—´åˆ¤æ–­ï¼š**
```bash
python discovering.py --mode=fast_slow --enable_mllm_intermediate_judge
```

**ä¼ ç»Ÿæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ï¼š**
```bash  
python discovering.py --mode=fast_slow
```

**å¯¹åº”ä»£ç ä½ç½®ï¼š** `discovering.py` ç¬¬374è¡Œå‚æ•°å®šä¹‰

## ğŸ’¡ MLLMä¸­é—´åˆ¤æ–­å®ç°è¯¦è§£

### 5.1 æç¤ºè¯è®¾è®¡

**æ ¸å¿ƒæç¤ºæ¨¡æ¿ï¼š** `fast_slow_thinking_system.py` ç¬¬194-208è¡Œ

```python
prompt = f"""ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å›¾åƒåˆ†ç±»ä¸“å®¶ã€‚è¯·åˆ†æè¿™å¼ å›¾åƒå’Œä»¥ä¸‹å€™é€‰åˆ†ç±»ç»“æœï¼Œ
åˆ¤æ–­ä½ æ˜¯å¦æœ‰è¶³å¤Ÿçš„ä¿¡å¿ƒåšå‡ºæœ€ç»ˆåˆ†ç±»å†³å®šã€‚

å€™é€‰ç±»åˆ«ï¼ˆæŒ‰ç›¸ä¼¼åº¦æ’åºï¼‰ï¼š
{candidates_text}

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼å›ç­”ï¼š
å†³ç­–ï¼š[æœ‰ä¿¡å¿ƒ/æ²¡ä¿¡å¿ƒ]
é¢„æµ‹ç±»åˆ«ï¼š[ç±»åˆ«åç§°]  
ç½®ä¿¡åº¦ï¼š[0-1çš„æ•°å€¼]
æ¨ç†ï¼š[ç®€è¦è¯´æ˜ä½ çš„åˆ¤æ–­ç†ç”±]"""
```

### 5.2 å“åº”è§£ææœºåˆ¶

**è§£æé€»è¾‘ï¼š** `fast_slow_thinking_system.py` ç¬¬220-265è¡Œ

| è§£æå­—æ®µ | åŒ¹é…æ¨¡å¼ | é»˜è®¤å€¼ | ä½œç”¨ |
|---------|----------|---------|------|
| **å†³ç­–åˆ¤æ–­** | `'æœ‰ä¿¡å¿ƒ' in response` | `False` | ä¸»è§‚ç½®ä¿¡åº¦è¯„ä¼° |
| **é¢„æµ‹ç±»åˆ«** | `"é¢„æµ‹ç±»åˆ«ï¼š" + ç±»åˆ«å` | `fused_results[0][0]` | å…œåº•é¢„æµ‹ç»“æœ |
| **æ•°å€¼ç½®ä¿¡åº¦** | `"ç½®ä¿¡åº¦ï¼š" + æµ®ç‚¹æ•°` | `0.5` | å®¢è§‚é‡åŒ–æŒ‡æ ‡ |

### 5.3 åŒé‡ç½®ä¿¡åº¦è¯„ä¼°æœºåˆ¶

```python
# fast_slow_thinking_system.py ç¬¬256è¡Œ
need_slow_thinking = not (decision_confident and confidence >= 0.6)
```

**é€»è¾‘è¡¨ï¼š**

| æ–‡æœ¬å†³ç­– | æ•°å€¼ç½®ä¿¡åº¦ | æœ€ç»ˆåˆ¤æ–­ | è§¦å‘æ…¢æ€è€ƒ |
|---------|-----------|----------|----------|
| æœ‰ä¿¡å¿ƒ | â‰¥ 0.6 | é«˜ç½®ä¿¡åº¦ | âŒ å¦ |
| æœ‰ä¿¡å¿ƒ | < 0.6 | ä¸­ç­‰ç½®ä¿¡åº¦ | âœ… æ˜¯ |
| æ²¡ä¿¡å¿ƒ | â‰¥ 0.6 | ä¸»è§‚ä¸ç¡®å®š | âœ… æ˜¯ |
| æ²¡ä¿¡å¿ƒ | < 0.6 | ä½ç½®ä¿¡åº¦ | âœ… æ˜¯ |

## ğŸ¯ ä¼˜åŒ–æ•ˆæœåˆ†æ

### 6.1 MLLMåˆ¤æ–­ä¼˜åŠ¿

| ä¼˜åŠ¿ç»´åº¦ | å…·ä½“è¡¨ç° | ç›¸æ¯”åŸæœ‰æœºåˆ¶ |
|---------|----------|-------------|
| **è¯­ä¹‰ç†è§£** | åŸºäºè§†è§‰å†…å®¹ç†è§£å›¾åƒç»†èŠ‚ç‰¹å¾ | ğŸ†š ä»…æ•°å€¼ç‰¹å¾åˆ†æ |
| **åœºæ™¯é€‚åº”** | è¯†åˆ«é®æŒ¡ã€æ¨¡ç³Šã€å˜å½¢ç­‰å¤æ‚æƒ…å†µ | ğŸ†š å›ºå®šé˜ˆå€¼æ•æ„Ÿ |
| **æ¨ç†é€æ˜** | æä¾›åˆ¤æ–­ç†ç”±å’Œæ¨ç†è¿‡ç¨‹ | ğŸ†š é»‘ç›’æ•°å€¼è®¡ç®— |
| **åŠ¨æ€è°ƒæ•´** | æ ¹æ®å›¾åƒå†…å®¹åŠ¨æ€è°ƒæ•´åˆ¤æ–­æ ‡å‡† | ğŸ†š é¢„è®¾å‚æ•°é…ç½® |

### 6.2 æ½œåœ¨é£é™©ä¸ç¼“è§£

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ | ä»£ç ä½ç½® |
|------|------|----------|----------|
| **MLLMè°ƒç”¨å¤±è´¥** | ç³»ç»Ÿå¼‚å¸¸ | å®¹é”™æœºåˆ¶ï¼Œé»˜è®¤è¿›å…¥æ…¢æ€è€ƒ | `fast_slow_thinking_system.py:214-217` |
| **å“åº”è§£æé”™è¯¯** | åˆ¤æ–­å¤±æ•ˆ | é»˜è®¤å€¼å…œåº• + ç»“æ„åŒ–è§£æ | `fast_slow_thinking_system.py:220-265` |
| **è®¡ç®—å¼€é”€å¢åŠ ** | æ¨ç†æ—¶é—´â†‘ | å¯é€‰å¼€å…³ï¼Œæ”¯æŒä¼ ç»Ÿæ¨¡å¼ | `discovering.py:374` |
| **æ¨¡å‹å¹»è§‰å½±å“** | è¯¯åˆ¤é£é™© | åŒé‡ç½®ä¿¡åº¦éªŒè¯æœºåˆ¶ | `fast_slow_thinking_system.py:256` |

## ğŸ§ª æ¶ˆèå®éªŒè®¾è®¡

### 7.1 å®éªŒå¯¹æ¯”æ–¹æ¡ˆ

| å®éªŒç»„ | è§¦å‘æœºåˆ¶ | å‘½ä»¤è¡Œå‚æ•° | è¯„ä¼°é‡ç‚¹ |
|--------|----------|-----------|----------|
| **åŸºçº¿ç»„** | ä¼ ç»Ÿè§„åˆ™è§¦å‘ | `--mode=fast_slow` | å»ºç«‹æ€§èƒ½åŸºçº¿ |
| **ä¼˜åŒ–ç»„** | MLLMä¸­é—´åˆ¤æ–­ | `--mode=fast_slow --enable_mllm_intermediate_judge` | éªŒè¯ä¼˜åŒ–æ•ˆæœ |
| **å¯¹ç…§ç»„** | å¼ºåˆ¶æ…¢æ€è€ƒ | `--mode=slowonly` | ä¸Šé™æ€§èƒ½å‚è€ƒ |
| **æ•ˆç‡ç»„** | ä»…å¿«æ€è€ƒ | `--mode=fastonly` | æ•ˆç‡åŸºå‡†å‚è€ƒ |

### 7.2 å…³é”®è¯„ä¼°æŒ‡æ ‡

| æŒ‡æ ‡ç±»å‹ | å…·ä½“æŒ‡æ ‡ | è®¡ç®—æ–¹å¼ | æœŸæœ›å˜åŒ– |
|---------|---------|----------|----------|
| **å‡†ç¡®æ€§** | Top-1åˆ†ç±»å‡†ç¡®ç‡ | `æ­£ç¡®åˆ†ç±»æ•° / æ€»æ ·æœ¬æ•°` | â¬†ï¸ æå‡2-5% |
| **æ•ˆç‡** | æ…¢æ€è€ƒè§¦å‘ç‡ | `è§¦å‘æ…¢æ€è€ƒæ•° / æ€»æ ·æœ¬æ•°` | â¬‡ï¸ é™ä½10-20% |
| **æ—¶é—´** | å¹³å‡æ¨ç†æ—¶é—´ | `æ€»æ¨ç†æ—¶é—´ / æ ·æœ¬æ•°` | â¬†ï¸ å¢åŠ ~500ms |
| **ç¨³å®šæ€§** | è¾¹ç•Œcaseè¯¯åˆ¤ç‡ | `è¾¹ç•Œè¯¯åˆ¤æ•° / è¾¹ç•Œæ ·æœ¬æ•°` | â¬‡ï¸ é™ä½è¯¯åˆ¤ |

## âš™ï¸ è°ƒä¼˜ä¸ä¼˜åŒ–ç­–ç•¥

### 8.1 å‚æ•°è°ƒä¼˜æŒ‡å—

| å‚æ•°åç§° | é»˜è®¤å€¼ | è°ƒä¼˜èŒƒå›´ | ä»£ç ä½ç½® | å½±å“ |
|---------|--------|----------|----------|------|
| **mllm_confidence_threshold** | `0.6` | `[0.5, 0.9]` | `fast_slow_thinking_system.py:256` | è§¦å‘æ•æ„Ÿåº¦ |
| **top_kå€™é€‰æ•°é‡** | `5` | `[3, 10]` | `fast_slow_thinking_system.py:182` | åˆ¤æ–­ä¿¡æ¯é‡ |

### 8.2 æç¤ºè¯ä¼˜åŒ–ç­–ç•¥

| ä¼˜åŒ–æ–¹å‘ | å…·ä½“æªæ–½ | é¢„æœŸæ•ˆæœ |
|---------|----------|----------|
| **ä»»åŠ¡æè¿°ç²¾åŒ–** | æ˜ç¡®ç»†ç²’åº¦åˆ†ç±»ä»»åŠ¡ç‰¹ç‚¹ | æå‡åˆ¤æ–­å‡†ç¡®æ€§ |
| **è¾“å‡ºæ ¼å¼çº¦æŸ** | å¼ºåŒ–ç»“æ„åŒ–è¾“å‡ºè¦æ±‚ | å‡å°‘è§£æé”™è¯¯ |
| **Few-shotå¼•å¯¼** | æ·»åŠ åˆ¤æ–­ç¤ºä¾‹ | æå‡ä¸€è‡´æ€§ |

### 8.3 æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **å¤šè½®åˆ¤æ–­æœºåˆ¶**: å¯¹ä¸­ç­‰ç½®ä¿¡åº¦(0.4-0.6)è¿›è¡Œç²¾ç»†åŒ–äºŒæ¬¡åˆ¤æ–­
2. **è‡ªé€‚åº”é˜ˆå€¼**: åŸºäºå†å²æˆåŠŸç‡åŠ¨æ€è°ƒæ•´ç½®ä¿¡åº¦é˜ˆå€¼
3. **å¤šæ¨¡å‹é›†æˆ**: èåˆå¤šä¸ªMLLMçš„åˆ¤æ–­ç»“æœæå‡ç¨³å®šæ€§

## ğŸ“‹ æ€»ç»“

### 9.1 æ ¸å¿ƒåˆ›æ–°ç‚¹

âœ… **è¯­ä¹‰è§¦å‘**: ä»æ•°å€¼è§„åˆ™è½¬å‘è§†è§‰è¯­ä¹‰ç†è§£  
âœ… **åŒé‡éªŒè¯**: ä¸»è§‚åˆ¤æ–­ + å®¢è§‚ç½®ä¿¡åº¦çš„åŒé‡æœºåˆ¶  
âœ… **å®Œå…¨å…¼å®¹**: ä¿æŒåŸæœ‰ç³»ç»Ÿæ¶æ„ï¼Œæ”¯æŒä¸€é”®åˆ‡æ¢  
âœ… **ç²¾å‡†å®šä½**: æ‰€æœ‰å…³é”®é€»è¾‘éƒ½æœ‰æ˜ç¡®çš„ä»£ç ä½ç½®ç´¢å¼•  

### 9.2 å®é™…åº”ç”¨ä»·å€¼

- **æå‡å‡†ç¡®æ€§**: é¢„æœŸåˆ†ç±»å‡†ç¡®ç‡æå‡2-5%
- **ä¼˜åŒ–æ•ˆç‡**: é¢„æœŸæ…¢æ€è€ƒè§¦å‘ç‡é™ä½10-20%  
- **å¢å¼ºç¨³å®šæ€§**: å‡å°‘é˜ˆå€¼è¾¹ç•Œçš„åˆ¤æ–­æŠ–åŠ¨
- **æ”¯æŒç ”ç©¶**: ä¸ºæ¶ˆèå®éªŒæä¾›å®Œæ•´çš„å¯¹æ¯”åŸºå‡†

### 9.3 é£é™©æ§åˆ¶

æ‰€æœ‰æ½œåœ¨é£é™©éƒ½æœ‰å¯¹åº”çš„ç¼“è§£æªæ–½å’Œå…œåº•ç­–ç•¥ï¼Œç¡®ä¿ç³»ç»Ÿçš„é²æ£’æ€§å’Œå¯é æ€§ã€‚é€šè¿‡å¯é€‰å¼€å…³è®¾è®¡ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚åœ¨ä¼ ç»Ÿæ¨¡å¼å’Œä¼˜åŒ–æ¨¡å¼ä¹‹é—´çµæ´»åˆ‡æ¢ã€‚

## ğŸ“ å®Œæ•´å…¬å¼æ±‡æ€»ä¸å®ç°ç»†èŠ‚

### 10.1 æ ¸å¿ƒç½®ä¿¡åº¦è®¡ç®—å…¬å¼

#### 10.1.1 èåˆTop-1ç½®ä¿¡åº¦ (fused_top1_prob)

**ç”¨é€”**ï¼šå±‚çº§1ã€å±‚çº§3åˆ¤æ–­

**è®¡ç®—æ­¥éª¤**ï¼š
```python
# 1. æ¸©åº¦ç¼©æ”¾
scaled_scores = scores / T  # Tä¸ºsoftmaxæ¸©åº¦å‚æ•°(0.07)

# 2. æ•°å€¼ç¨³å®šæ€§å¤„ç†
scaled_scores = scaled_scores - max(scaled_scores)

# 3. Softmaxå½’ä¸€åŒ–
exp_scores = exp(scaled_scores)
fused_probs = exp_scores / sum(exp_scores)

# 4. å–Top-1æ¦‚ç‡
fused_top1_prob = fused_probs[0]
```

**æ•°å­¦å…¬å¼**ï¼š
```
fused_top1_prob = exp((sâ‚/T) - max(s/T)) / Î£áµ¢ exp((sáµ¢/T) - max(s/T))
```

**ä»£ç ä½ç½®**ï¼š`fast_thinking.py:436-443`

---

#### 10.1.2 è¾¹é™…å·®å¼‚ (fused_margin)

**ç”¨é€”**ï¼šå±‚çº§1åˆ¤æ–­ï¼ˆè¡¡é‡Top-1ä¸Top-2çš„å·®è·ï¼‰

**è®¡ç®—é€»è¾‘**ï¼š
```python
if len(fused_probs) >= 2:
    fused_margin = fused_probs[0] - fused_probs[1]
else:
    fused_margin = fused_top1_prob  # åªæœ‰ä¸€ä¸ªå€™é€‰æ—¶é€€åŒ–
```

**æ•°å­¦å…¬å¼**ï¼š
```
fused_margin = P(top1) - P(top2)
```

**ç‰©ç†æ„ä¹‰**ï¼šå·®è·è¶Šå¤§ï¼Œè¯´æ˜Top-1è¶Šæ˜æ˜¾ï¼Œè¶Šå¯ä¿¡

**ä»£ç ä½ç½®**ï¼š`fast_thinking.py:443`

---

#### 10.1.3 åŒæ¨¡æ€ç½®ä¿¡åº¦ (img_confidence / text_confidence)

**ç”¨é€”**ï¼šå±‚çº§2åˆ¤æ–­ã€LCBè®¡ç®—

**è®¡ç®—æ­¥éª¤**ï¼š
```python
# å›¾åƒæ¨¡æ€
img_probs = softmax(img_results)  # å¯¹å›¾åƒæ£€ç´¢ç»“æœsoftmax
img_confidence = max(img_probs)    # å–æœ€å¤§æ¦‚ç‡

# æ–‡æœ¬æ¨¡æ€
text_probs = softmax(text_results) # å¯¹æ–‡æœ¬æ£€ç´¢ç»“æœsoftmax
text_confidence = max(text_probs)  # å–æœ€å¤§æ¦‚ç‡
```

**è¾…åŠ©å‡½æ•°**ï¼š
```python
def _to_probs(results: Dict[str, float]) -> Dict[str, float]:
    """å°†ç›¸ä¼¼åº¦åˆ†æ•°è½¬æ¢ä¸ºæ¦‚ç‡åˆ†å¸ƒ"""
    scores = np.array(list(results.values()))
    exp_scores = np.exp(scores - np.max(scores))
    probs = exp_scores / np.sum(exp_scores)
    return dict(zip(results.keys(), probs))
```

**ä»£ç ä½ç½®**ï¼š`fast_thinking.py:459-462`

---

### 10.2 æ¨¡æ€ä¸€è‡´æ€§åˆ¤æ–­å…¬å¼

#### 10.2.1 è¯­ä¹‰ç›¸ä¼¼åº¦ (categories_match_soft)

**åˆ¤æ–­é€»è¾‘**ï¼š
```python
categories_match_soft = is_similar(img_category, text_category, threshold=0.7)
```

**is_similarå‡½æ•°**ï¼šä½¿ç”¨ç¼–è¾‘è·ç¦»è®¡ç®—è¯­ä¹‰ç›¸ä¼¼åº¦
```python
def is_similar(str1, str2, threshold=0.7):
    # è®¡ç®—å½’ä¸€åŒ–ç¼–è¾‘è·ç¦»
    distance = edit_distance(str1.lower(), str2.lower())
    max_len = max(len(str1), len(str2))
    similarity = 1 - (distance / max_len)
    return similarity >= threshold
```

**ä»£ç ä½ç½®**ï¼š`fast_thinking.py:306` + `utils/util.py`

---

#### 10.2.2 Top-Kåç§°è½¯ä¸€è‡´ (name_soft_agree)

**åˆ¤æ–­é€»è¾‘**ï¼š
```python
name_soft_agree = False
for ci in img_topk:  # å›¾åƒTop-K
    for ct in text_topk:  # æ–‡æœ¬Top-K
        if is_similar(ci, ct, threshold=0.7):
            name_soft_agree = True
            break
```

**ç‰©ç†æ„ä¹‰**ï¼šåªè¦å›¾åƒå’Œæ–‡æœ¬çš„Top-Kç»“æœä¸­æœ‰ä»»æ„ä¸€å¯¹ç›¸ä¼¼ï¼Œå°±è®¤ä¸ºå­˜åœ¨è½¯ä¸€è‡´æ€§

**ä»£ç ä½ç½®**ï¼š`fast_thinking.py:457-465`

---

### 10.3 Top-Ké‡å åˆ¤æ–­å…¬å¼

**è®¡ç®—é€»è¾‘**ï¼š
```python
# 1. æå–Top-Kç±»åˆ«
img_topk = [cat for cat, _ in img_results[:K]]  # K=3
text_topk = [cat for cat, _ in text_results[:K]]

# 2. è®¡ç®—äº¤é›†
img_set = set(img_topk)
text_set = set(text_topk)
topk_overlap = len(img_set & text_set) > 0
```

**æ•°å­¦è¡¨ç¤º**ï¼š
```
topk_overlap = |TopK_img âˆ© TopK_text| > 0
```

**ä»£ç ä½ç½®**ï¼š`fast_thinking.py:445-448`

---

### 10.4 LCBå®Œæ•´è®¡ç®—å…¬å¼

**æœ€ç»ˆå…¬å¼**ï¼š
```
LCB = pÌ‚ - confidence_term - Î± Ã— H
```

**è¯¦ç»†å±•å¼€**ï¼š

**1) Betaå…ˆéªŒå¹³æ»‘**ï¼š
```
n = n_raw + prior_strength
m = m_raw + prior_p Ã— prior_strength
pÌ‚ = m / (n + Îµ)
```

å…¶ä¸­ï¼š
- `n_raw`: è¯¥ç±»åˆ«å†å²é¢„æµ‹æ¬¡æ•°
- `m_raw`: è¯¥ç±»åˆ«å†å²æ­£ç¡®æ¬¡æ•°
- `prior_strength = 2.0`: å…ˆéªŒå¼ºåº¦
- `prior_p = 0.6`: å…ˆéªŒæ­£ç¡®ç‡
- `Îµ = 1e-6`: æ•°å€¼ç¨³å®šé¡¹

**2) ç½®ä¿¡åº¦åˆ†å¸ƒç†µ**ï¼š
```
probs = [câ‚, câ‚‚, câ‚ƒ] / Î£cáµ¢
H = -Î£(páµ¢ Ã— log(páµ¢)) / log(3)
```

å…¶ä¸­ `[câ‚, câ‚‚, câ‚ƒ] = [img_confidence, text_confidence, fused_top1_prob]`

**3) ç½®ä¿¡åŒºé—´é¡¹**ï¼š
```
if n_raw > 0:
    confidence_term = Î· Ã— sqrt(log(N) / (2n + 1))
else:
    confidence_term = Î· Ã— sqrt(log(N))
```

å…¶ä¸­ï¼š
- `Î· = 1.0`: ç½®ä¿¡åŒºé—´ç³»æ•°
- `N`: æ€»é¢„æµ‹æ¬¡æ•°

**4) æœ€ç»ˆLCB**ï¼š
```
LCB = clip(pÌ‚ - confidence_term - Î± Ã— H, 0, 1)
```

å…¶ä¸­ `Î± = 0.5`: ç†µæƒé‡ç³»æ•°

**ä»£ç ä½ç½®**ï¼š`fast_thinking.py:343-383`

---

### 10.5 å››å±‚çº§åˆ¤æ–­é˜ˆå€¼æ±‡æ€»

| å±‚çº§ | åˆ¤æ–­æ¡ä»¶ | æ•°å­¦è¡¨è¾¾å¼ | é˜ˆå€¼ | ä»£ç ä½ç½® |
|------|----------|-----------|------|----------|
| **å±‚çº§1** | é«˜ç½®ä¿¡åº¦ + å¤§è¾¹é™… | `fused_top1_prob â‰¥ Î¸â‚ âˆ§ fused_margin â‰¥ Î¸â‚‚` | Î¸â‚=0.6, Î¸â‚‚=0.12 | `309-310` |
| **å±‚çº§2** | æ¨¡æ€ä¸€è‡´ + åŒé«˜ç½®ä¿¡ | `categories_match_soft âˆ§ img_conf â‰¥ Î¸â‚ƒ âˆ§ text_conf â‰¥ Î¸â‚ƒ` | Î¸â‚ƒ=0.5 | `313-314` |
| **å±‚çº§3** | Top-Ké‡å  + é«˜ç½®ä¿¡ | `topk_overlap âˆ§ fused_top1_prob â‰¥ Î¸â‚„` | Î¸â‚„=0.54 | `317-318` |
| **å±‚çº§4** | LCBé˜ˆå€¼ | `LCB â‰¥ Î¸â‚…` | Î¸â‚…=0.7 | `334-337` |

**å†³ç­–é€»è¾‘**ï¼š
```python
if å±‚çº§1æ»¡è¶³ or å±‚çº§2æ»¡è¶³ or å±‚çº§3æ»¡è¶³ or å±‚çº§4æ»¡è¶³:
    return False  # æ— éœ€æ…¢æ€è€ƒ
else:
    return True   # è§¦å‘æ…¢æ€è€ƒ
```

---

### 10.6 ç»Ÿè®¡é‡æ›´æ–°å…¬å¼

**æ›´æ–°é€»è¾‘**ï¼š
```python
def update_stats(category, is_correct):
    category_stats[category]["n"] += 1  # é¢„æµ‹æ¬¡æ•°+1
    if is_correct:
        category_stats[category]["m"] += 1  # æ­£ç¡®æ¬¡æ•°+1
```

**æ•°å­¦è¡¨ç¤º**ï¼š
```
n_raw â† n_raw + 1
m_raw â† m_raw + ğŸ™(é¢„æµ‹æ­£ç¡®)
```

å…¶ä¸­ `ğŸ™(Â·)` æ˜¯æŒ‡ç¤ºå‡½æ•°

**ä»£ç ä½ç½®**ï¼š`fast_thinking.py:385-396`

---

## ğŸ¯ å¿«æ€è€ƒè¿›å…¥æ…¢æ€è€ƒçš„å®Œæ•´æ€»ç»“

### 11.1 è§¦å‘æ…¢æ€è€ƒçš„æ‰€æœ‰æƒ…å†µ

å¿«æ€è€ƒä¼šåœ¨ä»¥ä¸‹**ä»»ä¸€æƒ…å†µ**è§¦å‘æ…¢æ€è€ƒï¼š

#### âŒ æƒ…å†µ1ï¼šèåˆç½®ä¿¡åº¦ä¸è¶³æˆ–è¾¹é™…å·®å¼‚å°
```
fused_top1_prob < 0.6  OR  fused_margin < 0.12
```
**å«ä¹‰**ï¼šèåˆç»“æœä¸å¤Ÿç¡®å®šï¼Œæˆ–Top-1ä¸Top-2å·®è·å¤ªå°

---

#### âŒ æƒ…å†µ2ï¼šæ¨¡æ€ä¸ä¸€è‡´æˆ–å•æ¨¡æ€ç½®ä¿¡åº¦ä½
```
NOT categories_match_soft  OR  img_confidence < 0.5  OR  text_confidence < 0.5
```
**å«ä¹‰**ï¼šå›¾åƒå’Œæ–‡æœ¬ç»“æœä¸ä¸€è‡´ï¼Œæˆ–ä»»ä¸€æ¨¡æ€ç½®ä¿¡åº¦ä¸è¶³

---

#### âŒ æƒ…å†µ3ï¼šTop-Kæ— é‡å æˆ–èåˆç½®ä¿¡åº¦ä¸å¤Ÿ
```
NOT topk_overlap  OR  fused_top1_prob < 0.54
```
**å«ä¹‰**ï¼šå›¾åƒå’Œæ–‡æœ¬Top-Kç»“æœæ²¡æœ‰äº¤é›†ï¼Œæˆ–èåˆç½®ä¿¡åº¦æœªè¾¾æ ‡

---

#### âŒ æƒ…å†µ4ï¼šLCBå€¼è¿‡ä½
```
LCB < 0.7
```
**å«ä¹‰**ï¼šç»¼åˆå†å²è¡¨ç°å’Œå½“å‰ä¸ç¡®å®šæ€§ï¼Œè¯¥ç±»åˆ«ä¸å¯ä¿¡

---

### 11.2 æ— éœ€æ…¢æ€è€ƒçš„æ‰€æœ‰æƒ…å†µ

å¿«æ€è€ƒä¼šåœ¨ä»¥ä¸‹**ä»»ä¸€æƒ…å†µ**ç›´æ¥è¿”å›ç»“æœï¼Œæ— éœ€æ…¢æ€è€ƒï¼š

#### âœ… æƒ…å†µ1ï¼šé«˜ç½®ä¿¡åº¦ä¸”å¤§è¾¹é™…å·®å¼‚
```
fused_top1_prob â‰¥ 0.6  AND  fused_margin â‰¥ 0.12
```
**å«ä¹‰**ï¼šèåˆç»“æœéå¸¸ç¡®å®šï¼Œä¸”Top-1æ˜æ˜¾ä¼˜äºTop-2

---

#### âœ… æƒ…å†µ2ï¼šæ¨¡æ€ä¸€è‡´ä¸”åŒé«˜ç½®ä¿¡
```
categories_match_soft  AND  img_confidence â‰¥ 0.5  AND  text_confidence â‰¥ 0.5
```
**å«ä¹‰**ï¼šå›¾åƒå’Œæ–‡æœ¬ç»“æœä¸€è‡´ï¼Œä¸”ä¸¤ä¸ªæ¨¡æ€éƒ½æœ‰è¶³å¤Ÿç½®ä¿¡åº¦

---

#### âœ… æƒ…å†µ3ï¼šTop-Ké‡å ä¸”é«˜ç½®ä¿¡
```
topk_overlap  AND  fused_top1_prob â‰¥ 0.54
```
**å«ä¹‰**ï¼šå›¾åƒå’Œæ–‡æœ¬Top-Kæœ‰äº¤é›†ï¼Œä¸”èåˆç½®ä¿¡åº¦è¾¾æ ‡

---

#### âœ… æƒ…å†µ4ï¼šLCBå€¼è¶³å¤Ÿé«˜
```
LCB â‰¥ 0.7
```
**å«ä¹‰**ï¼šç»¼åˆå†å²è¡¨ç°å’Œå½“å‰ç¡®å®šæ€§ï¼Œè¯¥ç±»åˆ«å¯ä¿¡

---

### 11.3 å†³ç­–æ ‘æ€»è§ˆ

```
å¿«æ€è€ƒå®Œæˆ
    â”‚
    â”œâ”€â†’ å±‚çº§1æ£€æŸ¥ï¼šé«˜ç½®ä¿¡åº¦? â”€â”€YESâ”€â”€â†’ ç›´æ¥è¿”å› âœ…
    â”‚                      â”‚
    â”‚                      NO
    â”‚                      â†“
    â”œâ”€â†’ å±‚çº§2æ£€æŸ¥ï¼šæ¨¡æ€ä¸€è‡´? â”€â”€YESâ”€â”€â†’ ç›´æ¥è¿”å› âœ…
    â”‚                      â”‚
    â”‚                      NO
    â”‚                      â†“
    â”œâ”€â†’ å±‚çº§3æ£€æŸ¥ï¼šTop-Ké‡å ? â”€â”€YESâ”€â”€â†’ ç›´æ¥è¿”å› âœ…
    â”‚                      â”‚
    â”‚                      NO
    â”‚                      â†“
    â””â”€â†’ å±‚çº§4æ£€æŸ¥ï¼šLCBâ‰¥0.7? â”€â”€YESâ”€â”€â†’ ç›´æ¥è¿”å› âœ…
                           â”‚
                           NO
                           â†“
                      è§¦å‘æ…¢æ€è€ƒ âŒ
```

---

### 11.4 å…³é”®å‚æ•°é€ŸæŸ¥è¡¨

| å‚æ•°åç§° | é»˜è®¤å€¼ | ç”¨é€” | è°ƒæ•´å»ºè®® |
|---------|--------|------|---------|
| `fused_conf_threshold` | 0.6 | å±‚çº§1èåˆç½®ä¿¡åº¦é˜ˆå€¼ | æé«˜â†’æ›´ä¿å®ˆï¼Œé™ä½â†’æ›´æ¿€è¿› |
| `fused_margin_threshold` | 0.12 | å±‚çº§1è¾¹é™…å·®å¼‚é˜ˆå€¼ | æé«˜â†’è¦æ±‚Top-1æ›´æ˜æ˜¾ |
| `similarity_threshold` | 0.7 | å±‚çº§2è¯­ä¹‰ç›¸ä¼¼åº¦é˜ˆå€¼ | æé«˜â†’è¦æ±‚æ›´ä¸¥æ ¼åŒ¹é… |
| `per_modality_conf_threshold` | 0.5 | å±‚çº§2å•æ¨¡æ€ç½®ä¿¡åº¦é˜ˆå€¼ | æé«˜â†’è¦æ±‚æ›´é«˜ç½®ä¿¡åº¦ |
| `topk_for_overlap` | 3 | å±‚çº§3 Top-Kæ•°é‡ | å¢å¤§â†’æ›´å®¹æ˜“é‡å  |
| `lcb_threshold` | 0.7 | å±‚çº§4 LCBé˜ˆå€¼ | æé«˜â†’æ›´ä¾èµ–å†å²è¡¨ç° |
| `prior_strength` | 2.0 | LCBå…ˆéªŒå¼ºåº¦ | å¢å¤§â†’å†·å¯åŠ¨æ›´ä¿å®ˆ |
| `prior_p` | 0.6 | LCBå…ˆéªŒæ­£ç¡®ç‡ | è°ƒæ•´â†’æ”¹å˜åˆå§‹ä¿¡ä»»åº¦ |
| `lcb_eta` | 1.0 | LCBç½®ä¿¡åŒºé—´ç³»æ•° | å¢å¤§â†’æ›´ä¿å®ˆä¼°è®¡ |
| `lcb_alpha` | 0.5 | LCBç†µæƒé‡ç³»æ•° | å¢å¤§â†’æ›´é‡è§†ä¸ç¡®å®šæ€§ |

---

### 11.5 å®é™…åº”ç”¨ç¤ºä¾‹

**ç¤ºä¾‹1ï¼šé«˜ç½®ä¿¡åº¦åœºæ™¯**
```python
fused_top1_prob = 0.85  # å¾ˆé«˜
fused_margin = 0.25     # å·®è·å¤§
# ç»“æœï¼šå±‚çº§1æ»¡è¶³ï¼Œç›´æ¥è¿”å›ï¼Œæ— éœ€æ…¢æ€è€ƒ âœ…
```

**ç¤ºä¾‹2ï¼šæ¨¡æ€ä¸€è‡´åœºæ™¯**
```python
img_category = "Golden Retriever"
text_category = "Golden_Retriever"
img_confidence = 0.65
text_confidence = 0.70
# ç»“æœï¼šå±‚çº§2æ»¡è¶³ï¼ˆç›¸ä¼¼ä¸”åŒé«˜ç½®ä¿¡ï¼‰ï¼Œç›´æ¥è¿”å› âœ…
```

**ç¤ºä¾‹3ï¼šè¾¹ç•Œæƒ…å†µ**
```python
fused_top1_prob = 0.58  # ç•¥ä½äº0.6
fused_margin = 0.10     # ç•¥ä½äº0.12
img_confidence = 0.45   # ç•¥ä½äº0.5
LCB = 0.65              # ç•¥ä½äº0.7
# ç»“æœï¼šæ‰€æœ‰å±‚çº§éƒ½ä¸æ»¡è¶³ï¼Œè§¦å‘æ…¢æ€è€ƒ âŒ
```

**ç¤ºä¾‹4ï¼šLCBæ•‘æ´**
```python
# å‰ä¸‰å±‚çº§éƒ½ä¸æ»¡è¶³
fused_top1_prob = 0.55
img_confidence = 0.48
topk_overlap = False
# ä½†è¯¥ç±»åˆ«å†å²è¡¨ç°å¾ˆå¥½
LCB = 0.75  # â‰¥ 0.7
# ç»“æœï¼šå±‚çº§4æ»¡è¶³ï¼Œç›´æ¥è¿”å› âœ…
```

---

### 11.6 è°ƒä¼˜å»ºè®®

1. **æé«˜å‡†ç¡®æ€§**ï¼šå¢å¤§æ‰€æœ‰é˜ˆå€¼ï¼Œæ›´å¤šè§¦å‘æ…¢æ€è€ƒ
2. **æé«˜æ•ˆç‡**ï¼šé™ä½é˜ˆå€¼ï¼Œå‡å°‘æ…¢æ€è€ƒè°ƒç”¨
3. **å¹³è¡¡ç­–ç•¥**ï¼šé‡ç‚¹è°ƒæ•´LCBå‚æ•°ï¼Œå®ç°è‡ªé€‚åº”å¹³è¡¡
4. **ç‰¹å®šåœºæ™¯**ï¼šæ ¹æ®æ•°æ®é›†ç‰¹ç‚¹è°ƒæ•´similarity_threshold

**ä»£ç ä½ç½®**ï¼šæ‰€æœ‰å‚æ•°åœ¨ `fast_thinking.py` ç¬¬26-44è¡Œåˆå§‹åŒ–
